<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>E-Commerce Store</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='50' r='48' fill='%23d4af37' stroke='%23ec4899' stroke-width='4'/><path d='M50 20 L70 40 L60 40 L60 60 L70 70 L50 80 L30 70 L40 60 L40 40 L30 40 Z' fill='%23ffffff'/><circle cx='50' cy='44' r='6' fill='%23ec4899'/></svg>" type="image/svg+xml">
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      height: 100%;
    }
    html {
      height: 100%;
    }
    * {
      box-sizing: border-box;
    }
    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 16px 24px;
      border-radius: 8px;
      color: white;
      font-weight: 600;
      z-index: 1000;
      animation: slideIn 0.3s ease-out;
    }
    .toast.success {
      background-color: #10b981;
    }
    .toast.error {
      background-color: #ef4444;
    }
    @keyframes slideIn {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    .product-card {
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .product-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 10px 25px rgba(236, 72, 153, 0.2);
    }
    .cursor-pointer {
      cursor: pointer;
    }
    .whatsapp-float {
      position: fixed;
      bottom: 30px;
      right: 30px;
      width: 60px;
      height: 60px;
      background-color: #25D366;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      cursor: pointer;
      z-index: 999;
      transition: transform 0.3s, box-shadow 0.3s;
    }
    .whatsapp-float:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4);
    }
    .mobile-menu {
      position: fixed;
      top: 0;
      right: -100%;
      width: 80%;
      max-width: 300px;
      height: 100%;
      transition: right 0.3s ease-in-out;
      z-index: 1000;
      box-shadow: -4px 0 12px rgba(0, 0, 0, 0.3);
    }
    .mobile-menu.open {
      right: 0;
    }
    .mobile-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 999;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease-in-out;
    }
    .mobile-overlay.open {
      opacity: 1;
      pointer-events: auto;
    }
    .hamburger {
      display: none;
      flex-direction: column;
      gap: 4px;
      cursor: pointer;
      padding: 8px;
    }
    .hamburger span {
      width: 25px;
      height: 3px;
      background-color: currentColor;
      transition: all 0.3s ease;
      border-radius: 2px;
    }
    @media (max-width: 768px) {
      .hamburger {
        display: flex;
      }
      .desktop-nav {
        display: none;
      }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body>
  <div id="app" class="min-h-full flex flex-col"></div><!-- Floating WhatsApp Button --> <a href="https://wa.me/233242075619?text=Hello%20Rejoice%20Allure!%20I%20have%20a%20question." target="_blank" rel="noopener noreferrer" class="whatsapp-float" title="Chat with us on WhatsApp"> üí¨ </a>
  <script>
    (async function() {
      // Default configuration
      const defaultConfig = {
        background_color: '#fff0f5',
        surface_color: '#ffffff',
        text_color: '#4a1942',
        primary_action_color: '#ec4899',
        secondary_action_color: '#d4af37',
        font_family: 'Inter',
        font_size: 16,
        store_name: 'Rejoice Allure',
        store_tagline: 'Quality Products at Great Prices',
        hero_title: 'Welcome to Rejoice Allure',
        hero_subtitle: 'Discover amazing products',
        cart_button_text: 'View Cart',
        checkout_button_text: 'Proceed to Checkout',
        whatsapp_number: '233242075619'
      };

      // Initialize Element SDK
      if (window.elementSdk) {
        await window.elementSdk.init({
          defaultConfig,
          onConfigChange: async (config) => {
            renderPage();
          },
          mapToCapabilities: (config) => ({
            recolorables: [
              {
                get: () => config.background_color || defaultConfig.background_color,
                set: (value) => {
                  config.background_color = value;
                  window.elementSdk.setConfig({ background_color: value });
                }
              },
              {
                get: () => config.surface_color || defaultConfig.surface_color,
                set: (value) => {
                  config.surface_color = value;
                  window.elementSdk.setConfig({ surface_color: value });
                }
              },
              {
                get: () => config.text_color || defaultConfig.text_color,
                set: (value) => {
                  config.text_color = value;
                  window.elementSdk.setConfig({ text_color: value });
                }
              },
              {
                get: () => config.primary_action_color || defaultConfig.primary_action_color,
                set: (value) => {
                  config.primary_action_color = value;
                  window.elementSdk.setConfig({ primary_action_color: value });
                }
              },
              {
                get: () => config.secondary_action_color || defaultConfig.secondary_action_color,
                set: (value) => {
                  config.secondary_action_color = value;
                  window.elementSdk.setConfig({ secondary_action_color: value });
                }
              }
            ],
            borderables: [],
            fontEditable: {
              get: () => config.font_family || defaultConfig.font_family,
              set: (value) => {
                config.font_family = value;
                window.elementSdk.setConfig({ font_family: value });
              }
            },
            fontSizeable: {
              get: () => config.font_size || defaultConfig.font_size,
              set: (value) => {
                config.font_size = value;
                window.elementSdk.setConfig({ font_size: value });
              }
            }
          }),
          mapToEditPanelValues: (config) => new Map([
            ['store_name', config.store_name || defaultConfig.store_name],
            ['store_tagline', config.store_tagline || defaultConfig.store_tagline],
            ['hero_title', config.hero_title || defaultConfig.hero_title],
            ['hero_subtitle', config.hero_subtitle || defaultConfig.hero_subtitle],
            ['cart_button_text', config.cart_button_text || defaultConfig.cart_button_text],
            ['checkout_button_text', config.checkout_button_text || defaultConfig.checkout_button_text],
            ['whatsapp_number', config.whatsapp_number || defaultConfig.whatsapp_number]
          ])
        });
      }

      // Get config
      const config = window.elementSdk ? window.elementSdk.config : defaultConfig;

      // State management
      let products = [];
      let cart = [];
      let currentPage = 'home';
      let selectedCategory = 'all';
      let searchQuery = '';
      window.adminLoggedIn = false;

      // Define store categories
      const storeCategories = [
        { name: 'Hair Brands', icon: 'üíá‚Äç‚ôÄÔ∏è', description: 'Premium hair care brands' },
        { name: 'Hair Products', icon: '‚ú®', description: 'Quality hair styling products' },
        { name: 'Beauty Products', icon: 'üíÑ', description: 'Makeup and skincare essentials' },
        { name: 'African Prints', icon: 'üëó', description: 'Authentic African fabrics' },
        { name: 'Jewelries', icon: 'üíé', description: 'Elegant jewelry pieces' },
        { name: 'Bags', icon: 'üëú', description: 'Stylish bags and purses' },
        { name: 'Accessories', icon: 'üëí', description: 'Fashion accessories' }
      ];

      // Data handler for Data SDK
      const dataHandler = {
        onDataChanged(data) {
          console.log('üìä Data changed, received records:', data.length);
          
          products = data.filter(item => item.type === 'product');
          cart = data.filter(item => item.type === 'cart');
          
          console.log('Products:', products.length, 'Cart items:', cart.length);
          
          renderPage();
        }
      };

      // Initialize Data SDK
      if (window.dataSdk) {
        const initResult = await window.dataSdk.init(dataHandler);
        if (!initResult.isOk) {
          console.error('Failed to initialize Data SDK:', initResult.error);
        }
      }

      // Helper functions
      function showToast(message, type = 'success') {
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        toast.textContent = message;
        document.body.appendChild(toast);
        setTimeout(() => toast.remove(), 3000);
      }

      function navigate(page) {
        currentPage = page;
        renderPage();
      }

      function adminLogout() {
        window.adminLoggedIn = false;
        showToast('Logged out successfully', 'success');
        navigate('home');
      }

      function handleSearch(query) {
        searchQuery = query.toLowerCase();
        if (currentPage !== 'shop') {
          navigate('shop');
        } else {
          renderPage();
        }
      }

      window.handleSearch = handleSearch;

      function toggleMobileMenu() {
        const menu = document.getElementById('mobileMenu');
        const overlay = document.getElementById('mobileOverlay');
        menu.classList.toggle('open');
        overlay.classList.toggle('open');
      }

      window.toggleMobileMenu = toggleMobileMenu;

      function checkoutViaWhatsApp() {
        if (cart.length === 0) {
          showToast('Your cart is empty', 'error');
          return;
        }

        // Show shipping address form modal
        const modal = document.createElement('div');
        modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
        modal.innerHTML = `
          <div class="rounded-lg p-8 max-w-2xl w-full max-h-[90%] overflow-y-auto" style="background-color: ${config.surface_color || defaultConfig.surface_color};">
            <h2 class="text-2xl font-bold mb-6" style="color: ${config.text_color || defaultConfig.text_color};">Shipping Information</h2>
            <form id="checkoutForm" class="space-y-4">
              <div>
                <label for="customerName" class="block mb-2 font-semibold" style="color: ${config.text_color || defaultConfig.text_color};">Full Name *</label>
                <input 
                  type="text" 
                  id="customerName" 
                  required 
                  class="w-full px-4 py-2 rounded border" 
                  style="background-color: ${config.background_color || defaultConfig.background_color}; color: ${config.text_color || defaultConfig.text_color};"
                  placeholder="Enter your full name"
                >
              </div>
              <div>
                <label for="customerPhone" class="block mb-2 font-semibold" style="color: ${config.text_color || defaultConfig.text_color};">Phone Number *</label>
                <input 
                  type="tel" 
                  id="customerPhone" 
                  required 
                  class="w-full px-4 py-2 rounded border" 
                  style="background-color: ${config.background_color || defaultConfig.background_color}; color: ${config.text_color || defaultConfig.text_color};"
                  placeholder="e.g., 0242075619"
                >
              </div>
              <div>
                <label for="customerEmail" class="block mb-2 font-semibold" style="color: ${config.text_color || defaultConfig.text_color};">Email (Optional)</label>
                <input 
                  type="email" 
                  id="customerEmail" 
                  class="w-full px-4 py-2 rounded border" 
                  style="background-color: ${config.background_color || defaultConfig.background_color}; color: ${config.text_color || defaultConfig.text_color};"
                  placeholder="your.email@example.com"
                >
              </div>
              <div>
                <label for="shippingAddress" class="block mb-2 font-semibold" style="color: ${config.text_color || defaultConfig.text_color};">Shipping Address *</label>
                <textarea 
                  id="shippingAddress" 
                  required 
                  rows="3"
                  class="w-full px-4 py-2 rounded border" 
                  style="background-color: ${config.background_color || defaultConfig.background_color}; color: ${config.text_color || defaultConfig.text_color};"
                  placeholder="Enter your complete delivery address"
                ></textarea>
              </div>
              <div>
                <label for="shippingCity" class="block mb-2 font-semibold" style="color: ${config.text_color || defaultConfig.text_color};">City *</label>
                <input 
                  type="text" 
                  id="shippingCity" 
                  required 
                  class="w-full px-4 py-2 rounded border" 
                  style="background-color: ${config.background_color || defaultConfig.background_color}; color: ${config.text_color || defaultConfig.text_color};"
                  placeholder="e.g., Accra"
                >
              </div>
              <div>
                <label for="orderNotes" class="block mb-2 font-semibold" style="color: ${config.text_color || defaultConfig.text_color};">Order Notes (Optional)</label>
                <textarea 
                  id="orderNotes" 
                  rows="2"
                  class="w-full px-4 py-2 rounded border" 
                  style="background-color: ${config.background_color || defaultConfig.background_color}; color: ${config.text_color || defaultConfig.text_color};"
                  placeholder="Any special instructions for your order?"
                ></textarea>
              </div>
              <div class="flex gap-4 mt-6">
                <button type="submit" class="flex-1 px-6 py-3 rounded-lg font-semibold" style="background-color: #25D366; color: white;">
                  Complete Order via WhatsApp
                </button>
                <button type="button" onclick="this.closest('.fixed').remove()" class="px-6 py-3 rounded-lg font-semibold" style="background-color: ${config.secondary_action_color || defaultConfig.secondary_action_color}; color: white;">
                  Cancel
                </button>
              </div>
            </form>
          </div>
        `;
        document.body.appendChild(modal);

        // Handle form submission
        document.getElementById('checkoutForm').addEventListener('submit', (e) => {
          e.preventDefault();
          
          const name = document.getElementById('customerName').value.trim();
          const phone = document.getElementById('customerPhone').value.trim();
          const email = document.getElementById('customerEmail').value.trim();
          const address = document.getElementById('shippingAddress').value.trim();
          const city = document.getElementById('shippingCity').value.trim();
          const notes = document.getElementById('orderNotes').value.trim();

          const total = cart.reduce((sum, item) => sum + (item.product_price * item.quantity), 0);
          
          // Build order message with shipping info
          let message = "üõçÔ∏è *NEW ORDER*\n\n";
          
          message += "üì¶ *ORDER DETAILS:*\n";
          cart.forEach((item, index) => {
            message += `${index + 1}. ${item.product_name}\n`;
            message += `   Qty: ${item.quantity} √ó GH‚Çµ${item.product_price.toFixed(2)} = GH‚Çµ${(item.product_price * item.quantity).toFixed(2)}\n\n`;
          });
          message += `üí∞ *Total: GH‚Çµ${total.toFixed(2)}*\n\n`;
          
          message += "üë§ *CUSTOMER INFORMATION:*\n";
          message += `Name: ${name}\n`;
          message += `Phone: ${phone}\n`;
          if (email) message += `Email: ${email}\n`;
          message += `\nüìç *SHIPPING ADDRESS:*\n`;
          message += `${address}\n`;
          message += `City: ${city}\n`;
          
          if (notes) {
            message += `\nüìù *Special Instructions:*\n${notes}\n`;
          }
          
          message += "\n‚úÖ Please confirm this order. Thank you!";

          // Encode message for URL
          const encodedMessage = encodeURIComponent(message);
          
          // Get WhatsApp number from config
          const whatsappNumber = config.whatsapp_number || defaultConfig.whatsapp_number;
          
          // Open WhatsApp
          window.open(`https://wa.me/${whatsappNumber}?text=${encodedMessage}`, '_blank', 'noopener,noreferrer');
          
          modal.remove();
          showToast('Opening WhatsApp with your order details...', 'success');
        });
      }

      window.checkoutViaWhatsApp = checkoutViaWhatsApp;

      async function addToCart(productId) {
        const product = products.find(p => p.id === productId);
        if (!product) return;

        const existingCartItem = cart.find(item => item.product_id === productId);
        
        if (existingCartItem) {
          existingCartItem.quantity += 1;
          const updateResult = await window.dataSdk.update(existingCartItem);
          if (updateResult.isOk) {
            showToast('Cart updated!', 'success');
          } else {
            showToast('Failed to update cart', 'error');
          }
        } else {
          const cartItem = {
            type: 'cart',
            product_id: productId,
            product_name: product.name,
            product_price: product.price,
            product_image: product.image,
            quantity: 1,
            added_at: new Date().toISOString()
          };
          
          const createResult = await window.dataSdk.create(cartItem);
          if (createResult.isOk) {
            showToast('Added to cart!', 'success');
          } else {
            showToast('Failed to add to cart', 'error');
          }
        }
      }

      async function removeFromCart(cartItemId) {
        const cartItem = cart.find(item => item.__backendId === cartItemId);
        if (!cartItem) return;

        const deleteResult = await window.dataSdk.delete(cartItem);
        if (deleteResult.isOk) {
          showToast('Removed from cart', 'success');
        } else {
          showToast('Failed to remove item', 'error');
        }
      }

      async function updateCartQuantity(cartItemId, newQuantity) {
        const cartItem = cart.find(item => item.__backendId === cartItemId);
        if (!cartItem) return;

        if (newQuantity <= 0) {
          await removeFromCart(cartItemId);
          return;
        }

        cartItem.quantity = newQuantity;
        const updateResult = await window.dataSdk.update(cartItem);
        if (!updateResult.isOk) {
          showToast('Failed to update quantity', 'error');
        }
      }

      function showProductDetails(productId) {
        const product = products.find(p => p.id === productId);
        if (!product) return;

        const modal = document.createElement('div');
        modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
        modal.onclick = (e) => {
          if (e.target === modal) modal.remove();
        };

        modal.innerHTML = `
          <div class="rounded-lg p-8 max-w-4xl w-full max-h-[90%] overflow-y-auto" style="background-color: ${config.surface_color || defaultConfig.surface_color};">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
              <div>
                ${product.image ? `<img src="${product.image}" alt="${product.name}" class="w-full h-96 object-cover rounded-lg">` : `<div class="w-full h-96 rounded-lg flex items-center justify-center text-9xl" style="background-color: ${config.background_color || defaultConfig.background_color};">üì¶</div>`}
              </div>
              <div>
                <h2 class="font-bold mb-4" style="font-size: ${(config.font_size || defaultConfig.font_size) * 2}px; color: ${config.text_color || defaultConfig.text_color};">${product.name}</h2>
                <p class="mb-4 px-3 py-1 rounded-lg inline-block" style="font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px; color: ${config.text_color || defaultConfig.text_color}; background-color: ${config.background_color || defaultConfig.background_color};">${product.category}</p>
                <p class="font-bold mb-6" style="font-size: ${(config.font_size || defaultConfig.font_size) * 2}px; color: ${config.primary_action_color || defaultConfig.primary_action_color};">GH‚Çµ${product.price.toFixed(2)}</p>
                <p class="mb-8" style="font-size: ${(config.font_size || defaultConfig.font_size) * 1.125}px; color: ${config.text_color || defaultConfig.text_color}; line-height: 1.8;">${product.description}</p>
                
                <div class="mb-6">
                  <label class="block mb-3 font-semibold" style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 1.125}px;">Quantity:</label>
                  <div class="flex items-center gap-4">
                    <button onclick="this.nextElementSibling.stepDown()" class="px-4 py-2 rounded-lg font-bold" style="background-color: ${config.secondary_action_color || defaultConfig.secondary_action_color}; color: white; font-size: ${(config.font_size || defaultConfig.font_size) * 1.25}px;">-</button>
                    <input type="number" id="productQuantity" value="1" min="1" max="99" class="w-20 text-center px-4 py-2 rounded-lg border-2" style="background-color: ${config.background_color || defaultConfig.background_color}; color: ${config.text_color || defaultConfig.text_color}; border-color: ${config.primary_action_color || defaultConfig.primary_action_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 1.125}px;">
                    <button onclick="this.previousElementSibling.stepUp()" class="px-4 py-2 rounded-lg font-bold" style="background-color: ${config.secondary_action_color || defaultConfig.secondary_action_color}; color: white; font-size: ${(config.font_size || defaultConfig.font_size) * 1.25}px;">+</button>
                  </div>
                </div>

                <div class="flex gap-4">
                  <button onclick="
                    const qty = parseInt(document.getElementById('productQuantity').value);
                    addToCartWithQuantity('${product.id}', qty);
                    this.closest('.fixed').remove();
                  " class="flex-1 px-8 py-4 rounded-lg font-semibold transition-colors" style="background-color: ${config.primary_action_color || defaultConfig.primary_action_color}; color: white; font-size: ${(config.font_size || defaultConfig.font_size) * 1.125}px;">
                    Add to Cart
                  </button>
                  <button onclick="this.closest('.fixed').remove()" class="px-8 py-4 rounded-lg font-semibold transition-colors" style="background-color: ${config.secondary_action_color || defaultConfig.secondary_action_color}; color: white; font-size: ${(config.font_size || defaultConfig.font_size) * 1.125}px;">
                    Close
                  </button>
                </div>
              </div>
            </div>
          </div>
        `;
        document.body.appendChild(modal);
      }

      async function addToCartWithQuantity(productId, quantity = 1) {
        const product = products.find(p => p.id === productId);
        if (!product) return;

        const existingCartItem = cart.find(item => item.product_id === productId);
        
        if (existingCartItem) {
          existingCartItem.quantity += quantity;
          const updateResult = await window.dataSdk.update(existingCartItem);
          if (updateResult.isOk) {
            showToast(`Added ${quantity} more to cart!`, 'success');
          } else {
            showToast('Failed to update cart', 'error');
          }
        } else {
          const cartItem = {
            type: 'cart',
            product_id: productId,
            product_name: product.name,
            product_price: product.price,
            product_image: product.image,
            quantity: quantity,
            added_at: new Date().toISOString()
          };
          
          const createResult = await window.dataSdk.create(cartItem);
          if (createResult.isOk) {
            showToast(`Added ${quantity} to cart!`, 'success');
          } else {
            showToast('Failed to add to cart', 'error');
          }
        }
      }

      window.showProductDetails = showProductDetails;
      window.addToCartWithQuantity = addToCartWithQuantity;
      window.addToCart = addToCart;
      window.removeFromCart = removeFromCart;
      window.updateCartQuantity = updateCartQuantity;
      window.navigate = navigate;
      window.adminLogout = adminLogout;

      // Admin functions
      window.showAddProductForm = function(editProduct = null) {
        const isEdit = editProduct !== null;
        const modal = document.createElement('div');
        modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
        modal.innerHTML = `
          <div class="rounded-lg p-8 max-w-2xl w-full max-h-[90%] overflow-y-auto" style="background-color: ${config.surface_color || defaultConfig.surface_color};">
            <h2 class="text-2xl font-bold mb-6" style="color: ${config.text_color || defaultConfig.text_color};">${isEdit ? 'Edit Product' : 'Add New Product'}</h2>
            <form id="addProductForm" class="space-y-4">
              <div>
                <label class="block mb-2 font-semibold" style="color: ${config.text_color || defaultConfig.text_color};">Product Name</label>
                <input type="text" id="productName" required class="w-full px-4 py-2 rounded border" style="background-color: ${config.background_color || defaultConfig.background_color}; color: ${config.text_color || defaultConfig.text_color};" value="${isEdit ? editProduct.name : ''}">
              </div>
              <div>
                <label class="block mb-2 font-semibold" style="color: ${config.text_color || defaultConfig.text_color};">Description</label>
                <textarea id="productDescription" required rows="3" class="w-full px-4 py-2 rounded border" style="background-color: ${config.background_color || defaultConfig.background_color}; color: ${config.text_color || defaultConfig.text_color};">${isEdit ? editProduct.description : ''}</textarea>
              </div>
              <div>
                <label class="block mb-2 font-semibold" style="color: ${config.text_color || defaultConfig.text_color};">Price (GH‚Çµ)</label>
                <input type="number" id="productPrice" required step="0.01" min="0" class="w-full px-4 py-2 rounded border" style="background-color: ${config.background_color || defaultConfig.background_color}; color: ${config.text_color || defaultConfig.text_color};" value="${isEdit ? editProduct.price : ''}">
              </div>
              <div>
                <label class="block mb-2 font-semibold" style="color: ${config.text_color || defaultConfig.text_color};">Category</label>
                <select id="productCategory" required class="w-full px-4 py-2 rounded border" style="background-color: ${config.background_color || defaultConfig.background_color}; color: ${config.text_color || defaultConfig.text_color};">
                  <option value="">Select a category</option>
                  ${storeCategories.map(cat => `<option value="${cat.name}" ${isEdit && editProduct.category === cat.name ? 'selected' : ''}>${cat.name}</option>`).join('')}
                </select>
              </div>
              <div>
                <label class="block mb-2 font-semibold" style="color: ${config.text_color || defaultConfig.text_color};">Product Image</label>
                ${isEdit && editProduct.image ? `<div class="mb-2"><img src="${editProduct.image}" class="w-32 h-32 object-cover rounded" /></div>` : ''}
                <input type="file" id="productImage" accept="image/*" class="w-full px-4 py-2 rounded border" style="background-color: ${config.background_color || defaultConfig.background_color}; color: ${config.text_color || defaultConfig.text_color};">
                <div id="imagePreview" class="mt-2"></div>
              </div>
              <div class="flex gap-4 mt-6">
                <button type="submit" class="flex-1 px-6 py-3 rounded-lg font-semibold" style="background-color: ${config.primary_action_color || defaultConfig.primary_action_color}; color: white;">
                  ${isEdit ? 'Update Product' : 'Add Product'}
                </button>
                <button type="button" onclick="this.closest('.fixed').remove()" class="flex-1 px-6 py-3 rounded-lg font-semibold" style="background-color: ${config.secondary_action_color || defaultConfig.secondary_action_color}; color: white;">
                  Cancel
                </button>
              </div>
            </form>
          </div>
        `;
        document.body.appendChild(modal);

        // Image preview with automatic resizing
        document.getElementById('productImage').addEventListener('change', function(e) {
          const file = e.target.files[0];
          const preview = document.getElementById('imagePreview');
          
          if (!file) {
            preview.innerHTML = '';
            delete e.target.dataset.resizedImage;
            return;
          }

          // Validate file type
          if (!file.type.startsWith('image/')) {
            showToast('Please select a valid image file', 'error');
            e.target.value = '';
            preview.innerHTML = '';
            return;
          }

          // Validate file size (max 5MB before processing)
          if (file.size > 5 * 1024 * 1024) {
            showToast('Image must be smaller than 5MB', 'error');
            e.target.value = '';
            preview.innerHTML = '';
            return;
          }

          // Show loading state
          preview.innerHTML = `<div class="flex items-center gap-2" style="color: ${config.text_color || defaultConfig.text_color};"><div class="animate-spin">‚è≥</div> Processing image...</div>`;

          // Read and resize the image
          const reader = new FileReader();
          reader.onload = function(event) {
            const img = new Image();
            img.onload = function() {
              try {
                // Create canvas for resizing
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                // Set max dimensions (optimized for Data SDK)
                const MAX_WIDTH = 400;
                const MAX_HEIGHT = 400;
                let width = img.width;
                let height = img.height;
                
                // Calculate new dimensions maintaining aspect ratio
                if (width > height) {
                  if (width > MAX_WIDTH) {
                    height = Math.round(height * (MAX_WIDTH / width));
                    width = MAX_WIDTH;
                  }
                } else {
                  if (height > MAX_HEIGHT) {
                    width = Math.round(width * (MAX_HEIGHT / height));
                    height = MAX_HEIGHT;
                  }
                }
                
                canvas.width = width;
                canvas.height = height;
                
                // Draw resized image with better quality
                ctx.imageSmoothingEnabled = true;
                ctx.imageSmoothingQuality = 'high';
                ctx.drawImage(img, 0, 0, width, height);
                
                // Convert to base64 with optimized compression
                let quality = 0.8;
                let resizedDataUrl = canvas.toDataURL('image/jpeg', quality);
                
                // If still too large, reduce quality further
                while (resizedDataUrl.length > 300000 && quality > 0.3) {
                  quality -= 0.1;
                  resizedDataUrl = canvas.toDataURL('image/jpeg', quality);
                }
                
                const sizeInKB = Math.round(resizedDataUrl.length / 1024);
                
                if (resizedDataUrl.length > 400000) {
                  showToast('Image is too large. Please use a smaller image.', 'error');
                  e.target.value = '';
                  preview.innerHTML = '';
                  delete e.target.dataset.resizedImage;
                  return;
                }
                
                // Store resized image for form submission
                e.target.dataset.resizedImage = resizedDataUrl;
                
                // Show preview with success message
                preview.innerHTML = `
                  <div>
                    <img src="${resizedDataUrl}" class="max-w-full h-32 object-cover rounded mb-2">
                    <p style="font-size: ${(config.font_size || defaultConfig.font_size) * 0.75}px; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.7;">
                      ‚úì Ready (${sizeInKB}KB, ${width}x${height}px)
                    </p>
                  </div>
                `;
                
                showToast('Image ready!', 'success');
              } catch (error) {
                showToast('Failed to process image', 'error');
                e.target.value = '';
                preview.innerHTML = '';
                delete e.target.dataset.resizedImage;
              }
            };
            img.onerror = function() {
              showToast('Failed to load image', 'error');
              e.target.value = '';
              preview.innerHTML = '';
              delete e.target.dataset.resizedImage;
            };
            img.src = event.target.result;
          };
          reader.onerror = function() {
            showToast('Failed to read image file', 'error');
            e.target.value = '';
            preview.innerHTML = '';
            delete e.target.dataset.resizedImage;
          };
          reader.readAsDataURL(file);
        });

        // Form submission
        document.getElementById('addProductForm').addEventListener('submit', async (e) => {
          e.preventDefault();
          
          const submitButton = e.target.querySelector('button[type="submit"]');
          submitButton.disabled = true;
          submitButton.textContent = isEdit ? 'Updating...' : 'Adding...';

          try {
            const name = document.getElementById('productName').value.trim();
            const description = document.getElementById('productDescription').value.trim();
            const priceInput = document.getElementById('productPrice').value;
            const category = document.getElementById('productCategory').value.trim();
            const imageFile = document.getElementById('productImage').files[0];

            // Validate all fields
            if (!name) {
              throw new Error('Product name is required');
            }
            if (!description) {
              throw new Error('Description is required');
            }
            if (!priceInput || isNaN(parseFloat(priceInput))) {
              throw new Error('Valid price is required');
            }
            if (!category) {
              throw new Error('Category is required');
            }

            const price = parseFloat(priceInput);
            let imageData = isEdit ? editProduct.image : '';

            // Use the resized image data if available
            if (imageFile) {
              const imageInput = document.getElementById('productImage');
              imageData = imageInput.dataset.resizedImage || imageData;
              
              // If no resized image is stored, it means the image wasn't processed
              if (!imageInput.dataset.resizedImage && imageFile) {
                throw new Error('Please wait for image to finish processing');
              }
            }

            if (isEdit) {
              // Update existing product
              editProduct.name = name;
              editProduct.description = description;
              editProduct.price = price;
              editProduct.category = category;
              editProduct.image = imageData;
              
              const result = await window.dataSdk.update(editProduct);
              
              if (result.isOk) {
                showToast('Product updated successfully!', 'success');
                modal.remove();
              } else {
                throw new Error(result.error.message || 'Failed to update product');
              }
            } else {
              // Create new product
              const productData = {
                type: 'product',
                id: 'prod_' + Date.now(),
                name: name,
                description: description,
                price: price,
                category: category,
                image: imageData,
                created_at: new Date().toISOString()
              };

              const result = await window.dataSdk.create(productData);
              
              if (result.isOk) {
                showToast('Product added successfully!', 'success');
                modal.remove();
              } else {
                throw new Error(result.error.message || 'Failed to create product');
              }
            }
          } catch (error) {
            showToast(error.message || 'Failed to save product', 'error');
            submitButton.disabled = false;
            submitButton.textContent = isEdit ? 'Update Product' : 'Add Product';
          }
        });
      };

      function editProduct(productId) {
        const product = products.find(p => p.id === productId);
        if (!product) return;
        window.showAddProductForm(product);
      }

      async function deleteProduct(productId) {
        const product = products.find(p => p.id === productId);
        if (!product) return;

        const deleteResult = await window.dataSdk.delete(product);
        if (deleteResult.isOk) {
          showToast('Product deleted', 'success');
        } else {
          showToast('Failed to delete product', 'error');
        }
      }

      window.editProduct = editProduct;
      window.deleteProduct = deleteProduct;

      // Render functions
      function renderPage() {
        const app = document.getElementById('app');
        const backgroundColor = config.background_color || defaultConfig.background_color;
        const surfaceColor = config.surface_color || defaultConfig.surface_color;
        const textColor = config.text_color || defaultConfig.text_color;
        const primaryActionColor = config.primary_action_color || defaultConfig.primary_action_color;
        const secondaryActionColor = config.secondary_action_color || defaultConfig.secondary_action_color;
        const fontFamily = config.font_family || defaultConfig.font_family;
        const fontSize = config.font_size || defaultConfig.font_size;

        app.style.backgroundColor = backgroundColor;
        app.style.fontFamily = `${fontFamily}, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif`;
        app.style.fontSize = `${fontSize}px`;
        app.style.color = textColor;

        const cartCount = cart.reduce((sum, item) => sum + item.quantity, 0);

        const header = `
          <header class="shadow-md" style="background-color: ${primaryActionColor};">
            <div class="max-w-7xl mx-auto px-4 py-4">
              <div class="flex justify-between items-center gap-4">
                <div class="flex items-center gap-2 sm:gap-3 flex-shrink-0">
                  <div class="flex-shrink-0">
                    <svg width="40" height="40" viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg" class="sm:w-[50px] sm:h-[50px]">
                      <circle cx="25" cy="25" r="24" fill="${secondaryActionColor}" stroke="white" stroke-width="2"/>
                      <path d="M25 10 L35 20 L30 20 L30 30 L35 35 L25 40 L15 35 L20 30 L20 20 L15 20 Z" fill="white"/>
                      <circle cx="25" cy="22" r="3" fill="${primaryActionColor}"/>
                    </svg>
                  </div>
                  <div>
                    <h1 class="font-bold leading-tight" style="font-size: ${fontSize * 1.125}px; color: ${secondaryActionColor};">
                      <span class="sm:hidden">${(config.store_name || defaultConfig.store_name).split(' ')[0]}</span>
                      <span class="hidden sm:inline">${config.store_name || defaultConfig.store_name}</span>
                    </h1>
                    <p class="hidden sm:block" style="font-size: ${fontSize * 0.875}px; color: ${secondaryActionColor}; opacity: 0.9;">${config.store_tagline || defaultConfig.store_tagline}</p>
                  </div>
                </div>
                
                <nav class="desktop-nav flex gap-6 items-center">
                  <button onclick="navigate('home')" class="font-semibold transition-opacity hover:opacity-70" style="color: ${secondaryActionColor}; font-size: ${fontSize}px;">Home</button>
                  <button onclick="selectedCategory='all'; navigate('shop')" class="font-semibold transition-opacity hover:opacity-70" style="color: ${secondaryActionColor}; font-size: ${fontSize}px;">Shop</button>
                  <button onclick="navigate('about')" class="font-semibold transition-opacity hover:opacity-70" style="color: ${secondaryActionColor}; font-size: ${fontSize}px;">About</button>
                  <button onclick="navigate('contact')" class="font-semibold transition-opacity hover:opacity-70" style="color: ${secondaryActionColor}; font-size: ${fontSize}px;">Contact</button>
                  <button onclick="navigate('admin')" class="font-semibold transition-opacity hover:opacity-70" style="color: ${secondaryActionColor}; font-size: ${fontSize}px;">Admin</button>
                </nav>

                <div class="flex items-center gap-3">
                  <div class="flex-1 max-w-md hidden lg:block">
                    <input 
                      type="text" 
                      id="searchInput"
                      placeholder="Search products..." 
                      value="${searchQuery}"
                      oninput="handleSearch(this.value)"
                      class="w-full px-4 py-2 rounded-lg border-2 focus:outline-none focus:border-opacity-80"
                      style="background-color: ${surfaceColor}; color: ${textColor}; border-color: ${secondaryActionColor}; font-size: ${fontSize * 0.875}px;"
                    />
                  </div>
                  <button onclick="navigate('cart')" class="hidden md:block px-4 py-2 rounded-lg font-semibold transition-colors" style="background-color: ${secondaryActionColor}; color: ${primaryActionColor}; font-size: ${fontSize}px;">
                    üõí Cart ${cartCount > 0 ? `(${cartCount})` : ''}
                  </button>
                  <button onclick="navigate('cart')" class="md:hidden px-3 py-2 rounded-lg font-semibold transition-colors" style="background-color: ${secondaryActionColor}; color: ${primaryActionColor}; font-size: ${fontSize * 0.875}px;">
                    üõí ${cartCount > 0 ? `(${cartCount})` : ''}
                  </button>
                  <div class="hamburger" onclick="toggleMobileMenu()" style="color: ${secondaryActionColor};">
                    <span></span>
                    <span></span>
                    <span></span>
                  </div>
                </div>
              </div>
              
              <div class="mt-4 lg:hidden">
                <input 
                  type="text" 
                  id="searchInputMobile"
                  placeholder="Search products..." 
                  value="${searchQuery}"
                  oninput="handleSearch(this.value)"
                  class="w-full px-4 py-2 rounded-lg border-2 focus:outline-none focus:border-opacity-80"
                  style="background-color: ${surfaceColor}; color: ${textColor}; border-color: ${secondaryActionColor}; font-size: ${fontSize * 0.875}px;"
                />
              </div>
            </div>
          </header>
          
          <!-- Mobile Menu Overlay -->
          <div id="mobileOverlay" class="mobile-overlay" onclick="toggleMobileMenu()"></div>
          
          <!-- Mobile Menu -->
          <div id="mobileMenu" class="mobile-menu" style="background-color: ${surfaceColor};">
            <div class="p-6">
              <div class="flex justify-between items-center mb-8">
                <h2 class="font-bold" style="font-size: ${fontSize * 1.5}px; color: ${textColor};">Menu</h2>
                <button onclick="toggleMobileMenu()" class="text-3xl" style="color: ${textColor};">√ó</button>
              </div>
              <nav class="flex flex-col gap-4">
                <button onclick="navigate('home'); toggleMobileMenu();" class="text-left px-4 py-3 rounded-lg font-semibold transition-colors" style="background-color: ${backgroundColor}; color: ${textColor}; font-size: ${fontSize * 1.125}px;">
                  üè† Home
                </button>
                <button onclick="selectedCategory='all'; navigate('shop'); toggleMobileMenu();" class="text-left px-4 py-3 rounded-lg font-semibold transition-colors" style="background-color: ${backgroundColor}; color: ${textColor}; font-size: ${fontSize * 1.125}px;">
                  üõçÔ∏è Shop
                </button>
                <button onclick="navigate('about'); toggleMobileMenu();" class="text-left px-4 py-3 rounded-lg font-semibold transition-colors" style="background-color: ${backgroundColor}; color: ${textColor}; font-size: ${fontSize * 1.125}px;">
                  ‚ÑπÔ∏è About
                </button>
                <button onclick="navigate('contact'); toggleMobileMenu();" class="text-left px-4 py-3 rounded-lg font-semibold transition-colors" style="background-color: ${backgroundColor}; color: ${textColor}; font-size: ${fontSize * 1.125}px;">
                  üìû Contact
                </button>
                <button onclick="navigate('admin'); toggleMobileMenu();" class="text-left px-4 py-3 rounded-lg font-semibold transition-colors" style="background-color: ${backgroundColor}; color: ${textColor}; font-size: ${fontSize * 1.125}px;">
                  üîê Admin
                </button>
                <button onclick="navigate('cart'); toggleMobileMenu();" class="text-left px-4 py-3 rounded-lg font-semibold transition-colors" style="background-color: ${primaryActionColor}; color: white; font-size: ${fontSize * 1.125}px;">
                  üõí Cart ${cartCount > 0 ? `(${cartCount})` : ''}
                </button>
              </nav>
            </div>
          </div>
        `;

        const footer = `
          <footer id="footer" class="mt-auto shadow-md" style="background-color: ${primaryActionColor};">
            <div class="max-w-7xl mx-auto px-4 py-8">
              <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-6">
                <div>
                  <h3 class="font-bold mb-3" style="font-size: ${fontSize * 1.25}px; color: ${secondaryActionColor};">${config.store_name || defaultConfig.store_name}</h3>
                  <p style="font-size: ${fontSize * 0.875}px; color: ${secondaryActionColor}; opacity: 0.9; line-height: 1.6;">
                    Quality products at great prices. Your trusted shopping destination for beauty, fashion, and lifestyle essentials.
                  </p>
                </div>
                <div>
                  <h3 class="font-bold mb-3" style="font-size: ${fontSize * 1.25}px; color: ${secondaryActionColor};">Contact Us</h3>
                  <div class="space-y-2" style="font-size: ${fontSize * 0.875}px; color: ${secondaryActionColor}; opacity: 0.9;">
                    <p>üìç 21st St. John's Street, Achimota, Accra</p>
                    <p>üìû 0242075619</p>
                    <p>üìß support@rejoiceallure.com</p>
                  </div>
                </div>
                <div>
                  <h3 class="font-bold mb-3" style="font-size: ${fontSize * 1.25}px; color: ${secondaryActionColor};">Follow Us</h3>
                  <div class="flex gap-4">
                    <a href="https://facebook.com/rejoiceallure" target="_blank" rel="noopener noreferrer" class="transition-transform hover:scale-110" title="Facebook">
                      <svg width="32" height="32" viewBox="0 0 24 24" fill="${secondaryActionColor}">
                        <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                      </svg>
                    </a>
                    <a href="https://twitter.com/rejoiceallure" target="_blank" rel="noopener noreferrer" class="transition-transform hover:scale-110" title="Twitter">
                      <svg width="32" height="32" viewBox="0 0 24 24" fill="${secondaryActionColor}">
                        <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                      </svg>
                    </a>
                    <a href="https://instagram.com/rejoiceallure" target="_blank" rel="noopener noreferrer" class="transition-transform hover:scale-110" title="Instagram">
                      <svg width="32" height="32" viewBox="0 0 24 24" fill="${secondaryActionColor}">
                        <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
                      </svg>
                    </a>
                    <a href="https://tiktok.com/@rejoiceallure" target="_blank" rel="noopener noreferrer" class="transition-transform hover:scale-110" title="TikTok">
                      <svg width="32" height="32" viewBox="0 0 24 24" fill="${secondaryActionColor}">
                        <path d="M19.59 6.69a4.83 4.83 0 0 1-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 0 1-5.2 1.74 2.89 2.89 0 0 1 2.31-4.64 2.93 2.93 0 0 1 .88.13V9.4a6.84 6.84 0 0 0-1-.05A6.33 6.33 0 0 0 5 20.1a6.34 6.34 0 0 0 10.86-4.43v-7a8.16 8.16 0 0 0 4.77 1.52v-3.4a4.85 4.85 0 0 1-1-.1z"/>
                      </svg>
                    </a>
                  </div>
                </div>
              </div>
              <div class="border-t pt-6 text-center" style="border-color: ${secondaryActionColor}; opacity: 0.3;">
                <p style="font-size: ${fontSize * 0.875}px; color: ${secondaryActionColor}; opacity: 0.9;">
                  ¬© ${new Date().getFullYear()} ${config.store_name || defaultConfig.store_name}. All rights reserved.
                </p>
              </div>
            </div>
          </footer>
        `;

        let content = document.getElementById('content');
        let headerElement = app.querySelector('header');
        let footerElement = document.getElementById('footer');
        
        if (!content) {
          // First time rendering - create the structure
          app.innerHTML = header + '<main id="content" class="flex-1"></main>' + footer;
          content = document.getElementById('content');
        } else {
          // Update existing elements
          if (headerElement) {
            headerElement.outerHTML = header;
          }
          if (footerElement) {
            footerElement.outerHTML = footer;
          }
        }

        switch (currentPage) {
          case 'categories':
            content.innerHTML = `
              <div class="max-w-7xl mx-auto px-4 py-12">
                <div class="text-center mb-12">
                  <h2 class="font-bold mb-4" style="font-size: ${fontSize * 2.5}px; color: ${textColor};">Shop by Category</h2>
                  <p style="font-size: ${fontSize * 1.125}px; color: ${textColor}; opacity: 0.8;">Choose a category to explore our collection</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                  ${storeCategories.map(category => `
                    <button onclick="selectedCategory='${category.name}'; navigate('shop');" class="product-card rounded-lg p-8 text-center transition-all" style="background-color: ${surfaceColor};">
                      <div class="text-6xl mb-4">${category.icon}</div>
                      <h3 class="font-bold mb-2" style="font-size: ${fontSize * 1.5}px; color: ${textColor};">${category.name}</h3>
                      <p class="mb-4" style="font-size: ${fontSize}px; color: ${textColor}; opacity: 0.7;">${category.description}</p>
                      <span class="inline-block px-6 py-2 rounded-lg font-semibold" style="background-color: ${primaryActionColor}; color: white; font-size: ${fontSize * 0.875}px;">
                        Browse ${category.name}
                      </span>
                    </button>
                  `).join('')}
                </div>
              </div>
            `;
            break;

          case 'home':
            content.innerHTML = `
              <div class="relative mb-12" style="background: linear-gradient(135deg, ${primaryActionColor}dd, ${secondaryActionColor}dd), url('data:image/svg+xml,%3Csvg width=%22100%22 height=%22100%22 xmlns=%22http://www.w3.org/2000/svg%22%3E%3Cdefs%3E%3Cpattern id=%22pattern%22 x=%220%22 y=%220%22 width=%2240%22 height=%2240%22 patternUnits=%22userSpaceOnUse%22%3E%3Ccircle cx=%2220%22 cy=%2220%22 r=%222%22 fill=%22white%22 opacity=%220.3%22/%3E%3C/pattern%3E%3C/defs%3E%3Crect width=%22100%25%22 height=%22100%25%22 fill=%22url(%23pattern)%22/%3E%3C/svg%3E'); background-size: cover; background-position: center; background-attachment: fixed;">
                <div class="max-w-7xl mx-auto px-4 py-24 text-center" style="backdrop-filter: blur(0px);">
                  <h2 class="font-bold mb-4 drop-shadow-lg" style="font-size: ${fontSize * 3}px; color: white; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);">${config.hero_title || defaultConfig.hero_title}</h2>
                  <p class="mb-8 drop-shadow-md" style="font-size: ${fontSize * 1.5}px; color: white; text-shadow: 1px 1px 2px rgba(0,0,0,0.3);">${config.hero_subtitle || defaultConfig.hero_subtitle}</p>
                  <button onclick="selectedCategory='all'; navigate('shop')" class="px-10 py-5 rounded-lg font-semibold transition-all hover:scale-105 shadow-lg" style="background-color: white; color: ${primaryActionColor}; font-size: ${fontSize * 1.25}px;">
                    Shop Now üõçÔ∏è
                  </button>
                </div>
              </div>
              <div class="max-w-7xl mx-auto px-4 py-12">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mt-16">
                  ${products.slice(0, 3).map(product => `
                    <div class="product-card rounded-lg p-6 text-center cursor-pointer" style="background-color: ${surfaceColor};" onclick="showProductDetails('${product.id}')">
                      ${product.image ? `<img src="${product.image}" alt="${product.name}" class="w-full h-48 object-cover rounded-lg mb-4">` : `<div class="w-full h-48 rounded-lg mb-4 flex items-center justify-center text-6xl" style="background-color: ${backgroundColor};">üì¶</div>`}
                      <h3 class="font-bold mb-2" style="font-size: ${fontSize * 1.25}px; color: ${textColor};">${product.name}</h3>
                      <p class="mb-4" style="font-size: ${fontSize}px; color: ${textColor}; opacity: 0.7;">${product.description.substring(0, 80)}...</p>
                      <p class="font-bold mb-4" style="font-size: ${fontSize * 1.5}px; color: ${primaryActionColor};">GH‚Çµ${product.price.toFixed(2)}</p>
                      <button onclick="event.stopPropagation(); addToCart('${product.id}')" class="w-full px-6 py-3 rounded-lg font-semibold transition-colors" style="background-color: ${primaryActionColor}; color: white; font-size: ${fontSize}px;">
                        Quick Add
                      </button>
                    </div>
                  `).join('')}
                </div>
              </div>
            `;
            break;

          case 'shop':
            const categories = ['all', ...storeCategories.map(c => c.name)];
            let filteredProducts = selectedCategory === 'all' ? products : products.filter(p => p.category === selectedCategory);
            
            // Apply search filter
            if (searchQuery) {
              filteredProducts = filteredProducts.filter(p => 
                p.name.toLowerCase().includes(searchQuery) || 
                p.description.toLowerCase().includes(searchQuery) ||
                p.category.toLowerCase().includes(searchQuery)
              );
            }
            
            content.innerHTML = `
              <div class="max-w-7xl mx-auto px-4 py-12">
                <h2 class="font-bold mb-8" style="font-size: ${fontSize * 2}px; color: ${textColor};">Shop All Products</h2>
                <div class="flex gap-4 mb-8 flex-wrap">
                  ${categories.map(cat => `
                    <button onclick="selectedCategory='${cat}'; renderPage();" class="px-6 py-2 rounded-lg font-semibold transition-colors" style="background-color: ${selectedCategory === cat ? primaryActionColor : secondaryActionColor}; color: white; font-size: ${fontSize * 0.875}px;">
                      ${cat.charAt(0).toUpperCase() + cat.slice(1)}
                    </button>
                  `).join('')}
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-6">
                  ${filteredProducts.map(product => `
                    <div class="product-card rounded-lg p-4 cursor-pointer" style="background-color: ${surfaceColor};" onclick="showProductDetails('${product.id}')">
                      ${product.image ? `<img src="${product.image}" alt="${product.name}" class="w-full h-40 object-cover rounded-lg mb-3">` : `<div class="w-full h-40 rounded-lg mb-3 flex items-center justify-center text-5xl" style="background-color: ${backgroundColor};">üì¶</div>`}
                      <h3 class="font-bold mb-2" style="font-size: ${fontSize * 1.125}px; color: ${textColor};">${product.name}</h3>
                      <p class="mb-3" style="font-size: ${fontSize * 0.875}px; color: ${textColor}; opacity: 0.7;">${product.description.substring(0, 60)}...</p>
                      <p class="font-bold mb-3" style="font-size: ${fontSize * 1.25}px; color: ${primaryActionColor};">GH‚Çµ${product.price.toFixed(2)}</p>
                      <button onclick="event.stopPropagation(); addToCart('${product.id}')" class="w-full px-4 py-2 rounded-lg font-semibold transition-colors" style="background-color: ${primaryActionColor}; color: white; font-size: ${fontSize * 0.875}px;">
                        Quick Add
                      </button>
                    </div>
                  `).join('')}
                </div>
              </div>
            `;
            break;

          case 'cart':
            const total = cart.reduce((sum, item) => sum + (item.product_price * item.quantity), 0);
            
            content.innerHTML = `
              <div class="max-w-4xl mx-auto px-4 py-12">
                <h2 class="font-bold mb-8" style="font-size: ${fontSize * 2}px; color: ${textColor};">Shopping Cart</h2>
                ${cart.length === 0 ? `
                  <div class="text-center py-12">
                    <p class="mb-6" style="font-size: ${fontSize * 1.25}px; color: ${textColor}; opacity: 0.7;">Your cart is empty</p>
                    <button onclick="navigate('shop')" class="px-8 py-3 rounded-lg font-semibold transition-colors" style="background-color: ${primaryActionColor}; color: white; font-size: ${fontSize}px;">
                      Continue Shopping
                    </button>
                  </div>
                ` : `
                  <div class="space-y-4 mb-8">
                    ${cart.map(item => `
                      <div class="flex gap-4 p-4 rounded-lg" style="background-color: ${surfaceColor};">
                        ${item.product_image ? `<img src="${item.product_image}" alt="${item.product_name}" class="w-24 h-24 object-cover rounded">` : `<div class="w-24 h-24 rounded flex items-center justify-center text-4xl" style="background-color: ${backgroundColor};">üì¶</div>`}
                        <div class="flex-1">
                          <h3 class="font-bold mb-2" style="font-size: ${fontSize * 1.125}px; color: ${textColor};">${item.product_name}</h3>
                          <p class="font-semibold" style="font-size: ${fontSize}px; color: ${primaryActionColor};">GH‚Çµ${item.product_price.toFixed(2)}</p>
                          <div class="flex gap-2 mt-2 items-center">
                            <button onclick="updateCartQuantity('${item.__backendId}', ${item.quantity - 1})" class="px-3 py-1 rounded font-bold" style="background-color: ${secondaryActionColor}; color: white; font-size: ${fontSize}px;">-</button>
                            <span class="px-4" style="font-size: ${fontSize}px; color: ${textColor};">${item.quantity}</span>
                            <button onclick="updateCartQuantity('${item.__backendId}', ${item.quantity + 1})" class="px-3 py-1 rounded font-bold" style="background-color: ${secondaryActionColor}; color: white; font-size: ${fontSize}px;">+</button>
                          </div>
                        </div>
                        <div class="text-right">
                          <p class="font-bold mb-4" style="font-size: ${fontSize * 1.25}px; color: ${textColor};">GH‚Çµ${(item.product_price * item.quantity).toFixed(2)}</p>
                          <button onclick="removeFromCart('${item.__backendId}')" class="px-4 py-2 rounded-lg font-semibold transition-colors" style="background-color: ${secondaryActionColor}; color: white; font-size: ${fontSize * 0.875}px;">
                            Remove
                          </button>
                        </div>
                      </div>
                    `).join('')}
                  </div>
                  <div class="rounded-lg p-6" style="background-color: ${surfaceColor};">
                    <div class="flex justify-between items-center mb-6">
                      <span class="font-bold" style="font-size: ${fontSize * 1.5}px; color: ${textColor};">Total:</span>
                      <span class="font-bold" style="font-size: ${fontSize * 1.5}px; color: ${primaryActionColor};">GH‚Çµ${total.toFixed(2)}</span>
                    </div>
                    <button onclick="checkoutViaWhatsApp()" class="w-full px-8 py-4 rounded-lg font-semibold transition-colors" style="background-color: #25D366; color: white; font-size: ${fontSize * 1.125}px;">
                      üí¨ ${config.checkout_button_text || defaultConfig.checkout_button_text}
                    </button>
                  </div>
                `}
              </div>
            `;
            break;

          case 'about':
            content.innerHTML = `
              <div class="max-w-4xl mx-auto px-4 py-12">
                <h2 class="font-bold mb-8" style="font-size: ${fontSize * 2}px; color: ${textColor};">About Us</h2>
                <div class="rounded-lg p-8 mb-8" style="background-color: ${surfaceColor};">
                  <p class="mb-6" style="font-size: ${fontSize * 1.125}px; color: ${textColor}; line-height: 1.8;">
                    Welcome to Rejoice Allure! We are passionate about bringing you the finest selection of products that enhance your lifestyle. Our mission is to provide exceptional quality, style, and outstanding customer service that makes every shopping experience delightful.
                  </p>
                  <p class="mb-6" style="font-size: ${fontSize * 1.125}px; color: ${textColor}; line-height: 1.8;">
                    Founded with a vision to celebrate beauty and elegance, we carefully curate our product selection to ensure you get only the best. Every item in our store is chosen with care, attention to detail, and a commitment to excellence that reflects the Rejoice Allure standard.
                  </p>
                  <p style="font-size: ${fontSize * 1.125}px; color: ${textColor}; line-height: 1.8;">
                    Thank you for choosing Rejoice Allure as your trusted shopping destination. We look forward to serving you and helping you discover products that bring joy and allure to your life!
                  </p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                  <div class="rounded-lg p-6 text-center" style="background-color: ${surfaceColor};">
                    <div class="text-5xl mb-4">üöö</div>
                    <h3 class="font-bold mb-2" style="font-size: ${fontSize * 1.25}px; color: ${textColor};">Fast Shipping</h3>
                    <p style="font-size: ${fontSize}px; color: ${textColor}; opacity: 0.7;">Quick and reliable delivery to your doorstep</p>
                  </div>
                  <div class="rounded-lg p-6 text-center" style="background-color: ${surfaceColor};">
                    <div class="text-5xl mb-4">‚ú®</div>
                    <h3 class="font-bold mb-2" style="font-size: ${fontSize * 1.25}px; color: ${textColor};">Quality Products</h3>
                    <p style="font-size: ${fontSize}px; color: ${textColor}; opacity: 0.7;">Carefully selected items you can trust</p>
                  </div>
                  <div class="rounded-lg p-6 text-center" style="background-color: ${surfaceColor};">
                    <div class="text-5xl mb-4">üíØ</div>
                    <h3 class="font-bold mb-2" style="font-size: ${fontSize * 1.25}px; color: ${textColor};">Customer Support</h3>
                    <p style="font-size: ${fontSize}px; color: ${textColor}; opacity: 0.7;">We're here to help whenever you need us</p>
                  </div>
                </div>
              </div>
            `;
            break;

          case 'contact':
            content.innerHTML = `
              <div class="max-w-3xl mx-auto px-4 py-12">
                <h2 class="font-bold mb-8" style="font-size: ${fontSize * 2}px; color: ${textColor};">Contact Us</h2>
                <div class="rounded-lg p-8 mb-8" style="background-color: ${surfaceColor};">
                  <p class="mb-8" style="font-size: ${fontSize * 1.125}px; color: ${textColor};">
                    Have a question or need assistance? We'd love to hear from you! Fill out the form below and we'll get back to you as soon as possible.
                  </p>
                  <form id="contactForm" class="space-y-6">
                    <div>
                      <label for="contactName" class="block mb-2 font-semibold" style="color: ${textColor}; font-size: ${fontSize}px;">Name</label>
                      <input 
                        type="text" 
                        id="contactName" 
                        required 
                        class="w-full px-4 py-3 rounded-lg border-2 focus:outline-none focus:border-opacity-80"
                        style="background-color: ${backgroundColor}; color: ${textColor}; border-color: ${primaryActionColor}; font-size: ${fontSize}px;"
                        placeholder="Your name"
                      />
                    </div>
                    <div>
                      <label for="contactEmail" class="block mb-2 font-semibold" style="color: ${textColor}; font-size: ${fontSize}px;">Email</label>
                      <input 
                        type="email" 
                        id="contactEmail" 
                        required 
                        class="w-full px-4 py-3 rounded-lg border-2 focus:outline-none focus:border-opacity-80"
                        style="background-color: ${backgroundColor}; color: ${textColor}; border-color: ${primaryActionColor}; font-size: ${fontSize}px;"
                        placeholder="your.email@example.com"
                      />
                    </div>
                    <div>
                      <label for="contactSubject" class="block mb-2 font-semibold" style="color: ${textColor}; font-size: ${fontSize}px;">Subject</label>
                      <input 
                        type="text" 
                        id="contactSubject" 
                        required 
                        class="w-full px-4 py-3 rounded-lg border-2 focus:outline-none focus:border-opacity-80"
                        style="background-color: ${backgroundColor}; color: ${textColor}; border-color: ${primaryActionColor}; font-size: ${fontSize}px;"
                        placeholder="How can we help?"
                      />
                    </div>
                    <div>
                      <label for="contactMessage" class="block mb-2 font-semibold" style="color: ${textColor}; font-size: ${fontSize}px;">Message</label>
                      <textarea 
                        id="contactMessage" 
                        required 
                        rows="6"
                        class="w-full px-4 py-3 rounded-lg border-2 focus:outline-none focus:border-opacity-80"
                        style="background-color: ${backgroundColor}; color: ${textColor}; border-color: ${primaryActionColor}; font-size: ${fontSize}px;"
                        placeholder="Tell us more about your inquiry..."
                      ></textarea>
                    </div>
                    <button 
                      type="submit" 
                      class="w-full px-8 py-4 rounded-lg font-semibold transition-colors"
                      style="background-color: ${primaryActionColor}; color: white; font-size: ${fontSize * 1.125}px;"
                    >
                      Send Message
                    </button>
                  </form>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <div class="rounded-lg p-6" style="background-color: ${surfaceColor};">
                    <div class="text-4xl mb-3">üìç</div>
                    <h3 class="font-bold mb-2" style="font-size: ${fontSize * 1.125}px; color: ${textColor};">Visit Us</h3>
                    <p style="font-size: ${fontSize}px; color: ${textColor}; opacity: 0.7;">21st St. John's Street<br>Achimota, Accra<br>Ghana</p>
                  </div>
                  <div class="rounded-lg p-6" style="background-color: ${surfaceColor};">
                    <div class="text-4xl mb-3">üìû</div>
                    <h3 class="font-bold mb-2" style="font-size: ${fontSize * 1.125}px; color: ${textColor};">Call Us</h3>
                    <p style="font-size: ${fontSize}px; color: ${textColor}; opacity: 0.7;">0242075619</p>
                  </div>
                  <div class="rounded-lg p-6" style="background-color: ${surfaceColor};">
                    <div class="text-4xl mb-3">üìß</div>
                    <h3 class="font-bold mb-2" style="font-size: ${fontSize * 1.125}px; color: ${textColor};">Email Us</h3>
                    <p style="font-size: ${fontSize}px; color: ${textColor}; opacity: 0.7;">support@rejoiceallure.com</p>
                  </div>
                  <div class="rounded-lg p-6" style="background-color: ${surfaceColor};">
                    <div class="text-4xl mb-3">üí¨</div>
                    <h3 class="font-bold mb-2" style="font-size: ${fontSize * 1.125}px; color: ${textColor};">WhatsApp</h3>
                    <a href="https://wa.me/233242075619?text=Hello%20Rejoice%20Allure!%20I%20have%20a%20question." target="_blank" rel="noopener noreferrer" class="inline-block px-4 py-2 rounded-lg font-semibold transition-colors mt-2" style="background-color: #25D366; color: white; font-size: ${fontSize * 0.875}px; text-decoration: none;">
                      Chat with Us
                    </a>
                  </div>
                </div>
              </div>
            `;
            
            // Handle contact form submission
            document.getElementById('contactForm').addEventListener('submit', (e) => {
              e.preventDefault();
              
              const name = document.getElementById('contactName').value.trim();
              const email = document.getElementById('contactEmail').value.trim();
              const subject = document.getElementById('contactSubject').value.trim();
              const message = document.getElementById('contactMessage').value.trim();
              
              // Build email content
              const emailSubject = encodeURIComponent(subject);
              const emailBody = encodeURIComponent(
                `Name: ${name}\n` +
                `Email: ${email}\n\n` +
                `Message:\n${message}`
              );
              
              // Open email client with pre-filled content
              window.open(`mailto:support@rejoiceallure.com?subject=${emailSubject}&body=${emailBody}`, '_blank', 'noopener,noreferrer');
              
              showToast('Opening your email client...', 'success');
              e.target.reset();
            });
            break;

          case 'admin':
            // Check if admin is logged in
            if (!window.adminLoggedIn) {
              content.innerHTML = `
                <div class="max-w-md mx-auto mt-20 px-4">
                  <div class="p-8 rounded-lg shadow-lg" style="background-color: ${surfaceColor};">
                    <h1 class="text-center font-bold mb-6" style="font-size: ${fontSize * 2}px; color: ${textColor};">Admin Login</h1>
                    <form id="adminLoginForm" class="space-y-4">
                      <div>
                        <label for="adminPassword" class="block mb-2 font-semibold" style="color: ${textColor}; font-size: ${fontSize}px;">Password</label>
                        <input 
                          type="password" 
                          id="adminPassword" 
                          class="w-full px-4 py-3 rounded-lg border-2 focus:outline-none focus:border-opacity-80"
                          style="background-color: ${backgroundColor}; color: ${textColor}; border-color: ${primaryActionColor}; font-size: ${fontSize}px;"
                          placeholder="Enter admin password"
                          required
                        />
                      </div>
                      <div id="loginError" class="text-red-500 hidden" style="font-size: ${fontSize * 0.875}px;"></div>
                      <button 
                        type="submit" 
                        class="w-full px-6 py-3 rounded-lg font-semibold transition-colors"
                        style="background-color: ${primaryActionColor}; color: white; font-size: ${fontSize}px;"
                      >
                        Login
                      </button>
                    </form>
                  </div>
                </div>
              `;
              
              // Handle login form submission
              document.getElementById('adminLoginForm').addEventListener('submit', (e) => {
                e.preventDefault();
                const password = document.getElementById('adminPassword').value;
                const ADMIN_PASSWORD = 'Rejoice@2025';
                
                if (password === ADMIN_PASSWORD) {
                  window.adminLoggedIn = true;
                  showToast('Login successful!', 'success');
                  navigate('admin');
                } else {
                  const errorDiv = document.getElementById('loginError');
                  errorDiv.textContent = 'Incorrect password. Please try again.';
                  errorDiv.classList.remove('hidden');
                  document.getElementById('adminPassword').value = '';
                }
              });
              return;
            }
            
            // Admin is logged in, show admin console
            content.innerHTML = `
              <div class="max-w-6xl mx-auto px-4 py-12">
                <div class="flex justify-between items-center mb-8">
                  <h1 class="font-bold" style="font-size: ${fontSize * 2}px; color: ${textColor};">Admin Console</h1>
                  <div class="flex gap-4">
                    <button onclick="adminLogout()" class="px-6 py-3 rounded-lg font-semibold transition-colors" style="background-color: ${secondaryActionColor}; color: white; font-size: ${fontSize}px;">
                      Logout
                    </button>
                    <button onclick="showAddProductForm()" class="px-6 py-3 rounded-lg font-semibold transition-colors" style="background-color: ${primaryActionColor}; color: white; font-size: ${fontSize}px;">
                      Add New Product
                    </button>
                  </div>
                </div>
                ${products.length === 0 ? `
                  <div class="text-center py-12 rounded-lg" style="background-color: ${surfaceColor};">
                    <p class="mb-6" style="font-size: ${fontSize * 1.25}px; color: ${textColor}; opacity: 0.7;">No products yet. Add your first product to get started!</p>
                    <button onclick="showAddProductForm()" class="px-8 py-3 rounded-lg font-semibold transition-colors" style="background-color: ${primaryActionColor}; color: white; font-size: ${fontSize}px;">
                      Add Product
                    </button>
                  </div>
                ` : `
                  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    ${products.map(product => `
                      <div class="rounded-lg p-4" style="background-color: ${surfaceColor};">
                        ${product.image ? `<img src="${product.image}" alt="${product.name}" class="w-full h-40 object-cover rounded-lg mb-3">` : `<div class="w-full h-40 rounded-lg mb-3 flex items-center justify-center text-5xl" style="background-color: ${backgroundColor};">üì¶</div>`}
                        <h3 class="font-bold mb-2" style="font-size: ${fontSize * 1.125}px; color: ${textColor};">${product.name}</h3>
                        <p class="mb-2" style="font-size: ${fontSize * 0.875}px; color: ${textColor}; opacity: 0.7;">${product.description.substring(0, 80)}...</p>
                        <p class="mb-1" style="font-size: ${fontSize * 0.75}px; color: ${textColor}; opacity: 0.6;">Category: ${product.category}</p>
                        <p class="font-bold mb-3" style="font-size: ${fontSize * 1.125}px; color: ${primaryActionColor};">GH‚Çµ${product.price.toFixed(2)}</p>
                        <div class="flex gap-2">
                          <button onclick="editProduct('${product.id}')" class="flex-1 px-4 py-2 rounded-lg font-semibold transition-colors" style="background-color: ${primaryActionColor}; color: white; font-size: ${fontSize * 0.875}px;">
                            Edit
                          </button>
                          <button onclick="deleteProduct('${product.id}')" class="flex-1 px-4 py-2 rounded-lg font-semibold transition-colors" style="background-color: ${secondaryActionColor}; color: white; font-size: ${fontSize * 0.875}px;">
                            Delete
                          </button>
                        </div>
                      </div>
                    `).join('')}
                  </div>
                `}
              </div>
            `;
            break;
        }
      }

      // Initial render
      renderPage();
    })();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99b3c5e3c7519330',t:'MTc2MjU5MTMwNC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
