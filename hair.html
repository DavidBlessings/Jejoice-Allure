<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rejoice Allure - Elegant Beauty & Accessories</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Use Playfair Display and Inter fonts -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&family=Playfair+Display:ital,wght@0,400..900;1,400..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #fefefe; /* Near white */
            min-height: 100vh; /* Ensure body takes full height for a clean look */
        }
        .text-gold {
            color: #B8860B; /* Darker Gold for elegance */
        }
        .bg-soft-pink {
            background-color: #fce4ec; /* Very light, soft pink */
        }
        .btn-gold {
            background-color: #FFD700; /* Bright gold for buttons */
            color: #8B4513; /* Brown-gold text for contrast */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
            transition: all 0.3s;
        }
        .btn-gold:hover {
            background-color: #FFC72C;
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
        }
        /* Custom class for active navigation link */
        .nav-active {
            color: #DB2777; /* pink-600 */
            border-bottom: 2px solid #DB2777;
        }
        /* Mobile Search Field adjustment */
        #mobile-search-container {
            padding: 1rem;
            border-top: 1px solid #fce4ec;
        }
        /* Style for the welcome message */
        .welcome-user {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 150px; /* Constrain width for desktop */
            font-weight: 500;
            color: #DB2777;
        }
        /* Style for selected payment option */
        .payment-option input:checked + div {
            border-color: #DB2777; /* Pink ring for selected option */
            box-shadow: 0 0 0 3px #F472B680;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #DB2777;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* --- NEW HERO BACKGROUND STYLES --- */
        .hero-background {
            /* Placeholder image for elegant pink/gold/white theme */
            background-image: url('https://placehold.co/1920x800/fce4ec/DB2777?text=Luxury+Accra+Beauty+Flatlay');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            position: relative;
        }

        /* Overlay for contrast */
        .hero-background::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(252, 228, 236, 0.7); /* Soft pink overlay (70% opacity) */
            z-index: 1;
        }
        .hero-content {
            position: relative;
            z-index: 10;
        }
    </style>
</head>
<body class="text-gray-800">

    <!-- Header & Navigation (STATIC) -->
    <header class="bg-white shadow-md sticky top-0 z-10">
        <div class="max-w-7xl mx-auto p-4 flex justify-between items-center">
            <!-- Logo/Brand Name -->
            <h1 class="text-3xl font-bold font-['Playfair_Display'] text-pink-600 cursor-pointer flex items-center" onclick="showSection('new-arrivals', this, true)">
                <!-- Logo SVG (Diamond/Gem Icon) -->
                <svg class="w-6 h-6 mr-2 text-gold fill-current" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M12 2l-8 7.5L12 22l8-12.5L12 2zM12 4.382L17.708 9.875L12 18.618L6.292 9.875L12 4.382z" fill="currentColor"/>
                </svg>
                Rejoice <span class="text-gold">Allure</span>
            </h1>
            
            <!-- Mobile Menu and Cart -->
            <nav class="flex items-center space-x-4">
                <!-- Hamburger Menu for Mobile (Hidden on Desktop) -->
                <button id="menu-button" class="md:hidden text-pink-600 focus:outline-none">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
                </button>

                <!-- Desktop Links, including search -->
                <div class="hidden md:flex items-center space-x-6 text-sm font-medium" id="desktop-nav">
                    <a href="#" data-section="new-arrivals" class="nav-link text-gray-600 hover:text-pink-600 transition duration-150" onclick="showSection('new-arrivals', this)">New Arrivals</a>
                    <a href="#" data-section="categories" class="nav-link text-gray-600 hover:text-pink-600 transition duration-150" onclick="showSection('categories', this)">Categories</a>
                    <a href="#" data-section="accessories" class="nav-link text-gray-600 hover:text-pink-600 transition duration-150" onclick="showSection('accessories', this)">Accessories</a>
                    <a href="#" data-section="beauty" class="nav-link text-gray-600 hover:text-pink-600 transition duration-150" onclick="showSection('beauty', this)">Beauty</a>
                    <a href="#" data-section="about-us" class="nav-link text-gray-600 hover:text-pink-600 transition duration-150" onclick="showSection('about-us', this)">About Us</a>
                    <a href="#" data-section="contact" class="nav-link text-gray-600 hover:text-pink-600 transition duration-150" onclick="showSection('contact', this)">Contact</a>
                    
                    <!-- NEW: ACCOUNT CONTROL -->
                    <a href="#" data-section="account" class="nav-link text-gray-600 hover:text-pink-600 transition duration-150" onclick="showSection('account', this)">Account</a>
                    
                    <!-- Desktop Search Field -->
                    <div class="relative ml-8">
                        <input type="text" id="product-search-desktop" placeholder="Search products..." class="w-48 p-2 text-sm rounded-full border border-pink-300 focus:ring-pink-500 focus:border-pink-500 transition duration-150 pl-10 bg-gray-50" oninput="handleSearch(this.value)">
                        <!-- Search Icon -->
                        <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                    </div>
                </div>
                
                <!-- Cart Icon (UPDATED to show Cart section) -->
                <div class="relative cursor-pointer text-pink-600 hover:text-gold transition duration-150" onclick="showSection('cart', this)">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l3 9h10l3-9H7M8 17h10a1 1 0 001-1V6H6L3 17z"></path></svg>
                    <span id="cart-count" class="absolute -top-1 -right-1 bg-gold text-white text-xs font-bold rounded-full h-4 w-4 flex items-center justify-center">0</span>
                </div>
            </nav>
        </div>

        <!-- Mobile Navigation Drawer -->
        <div id="mobile-menu" class="hidden md:hidden bg-white p-4 border-t border-pink-100">
            <!-- Mobile Search Field -->
            <div id="mobile-search-container" class="relative">
                 <input type="text" id="product-search-mobile" placeholder="Search products..." class="w-full p-3 text-base rounded-lg border border-pink-300 focus:ring-pink-500 focus:border-pink-500 transition duration-150 pl-10 bg-gray-50" oninput="handleSearch(this.value)">
                 <!-- Search Icon -->
                 <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
            </div>
            
            <a href="#" data-section="new-arrivals" class="block py-2 text-gray-700 hover:text-pink-600 nav-link-mobile" onclick="showSection('new-arrivals', this); mobileMenu.classList.add('hidden');">New Arrivals</a>
            <a href="#" data-section="categories" class="block py-2 text-gray-700 hover:text-pink-600 nav-link-mobile" onclick="showSection('categories', this); mobileMenu.classList.add('hidden');">Categories</a>
            <a href="#" data-section="accessories" class="block py-2 text-gray-700 hover:text-pink-600 nav-link-mobile" onclick="showSection('accessories', this); mobileMenu.classList.add('hidden');">Accessories</a>
            <a href="#" data-section="beauty" class="block py-2 text-gray-700 hover:text-pink-600 nav-link-mobile" onclick="showSection('beauty', this); mobileMenu.classList.add('hidden');">Beauty</a>
            <a href="#" data-section="about-us" class="block py-2 text-gray-700 hover:text-pink-600 nav-link-mobile" onclick="showSection('about-us', this); mobileMenu.classList.add('hidden');">About Us</a>
            <a href="#" data-section="contact" class="block py-2 text-gray-700 hover:text-pink-600 nav-link-mobile" onclick="showSection('contact', this); mobileMenu.classList.add('hidden');">Contact</a>
            
            <!-- NEW: AUTH CONTROLS MOBILE -->
            <a href="#" data-section="account" class="block py-2 text-gray-700 hover:text-pink-600 nav-link-mobile" onclick="showSection('account', this); mobileMenu.classList.add('hidden');">Account</a>

        </div>
    </header>

    <!-- Global Message Box -->
    <div id="message-box" class="fixed top-4 right-4 bg-pink-600 text-white p-3 rounded-lg shadow-xl z-50 transition-all duration-300 transform translate-x-full opacity-0">
        Message goes here.
    </div>
    
    <!-- Loading Indicator -->
    <div id="loading-overlay" class="fixed inset-0 bg-white bg-opacity-80 flex items-center justify-center z-[100] hidden">
        <div class="text-center">
            <div class="loader mx-auto mb-4"></div>
            <p class="text-pink-700 font-semibold">Loading data...</p>
        </div>
    </div>


    <!-- MAIN CONTENT CONTAINER - Swappable Sections -->
    <main>
        
        <!-- ============================================== -->
        <!-- 1. NEW ARRIVALS Section (Default View) -->
        <!-- ============================================== -->
        <section id="section-new-arrivals" class="content-section">
            <!-- Hero Section (UPDATED to use background image class) -->
            <div class="hero-background py-16 md:py-24 text-center">
                <div class="hero-content max-w-4xl mx-auto px-4">
                    <h2 class="text-4xl md:text-6xl font-['Playfair_Display'] font-extrabold text-pink-700 leading-tight mb-4">
                        Unlock Your Inner Radiance.
                    </h2>
                    <p class="text-lg text-gray-700 mb-8 max-w-2xl mx-auto">
                        Discover the exclusive collection of luxury accessories and curated beauty essentials designed for every moment of grace and allure.
                    </p>
                    <button class="btn-gold px-8 py-3 text-lg font-semibold rounded-full hover:shadow-lg inline-block" onclick="scrollToProducts()">
                        Shop The New Collection
                    </button>
                </div>
            </div>

            <!-- Product Grid Section -->
            <div class="py-16 px-4 max-w-7xl mx-auto">
                <h3 id="product-list-start" class="text-3xl md:text-4xl font-['Playfair_Display'] font-bold text-center text-pink-600 mb-12">
                    Featured New Arrivals
                </h3>

                <!-- Product container: RENDERED DYNAMICALLY BY JS -->
                <div id="product-list" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-6 md:gap-8">
                    <!-- Products will be injected here -->
                </div>
                
                <!-- Search Feedback -->
                <div id="search-feedback" class="hidden text-center py-10">
                    <p class="text-xl text-pink-600 font-medium">
                        No results found for your search query. Try another term!
                    </p>
                </div>
            </div>
            
             <!-- Featurette / Call to Action Banner -->
            <div class="bg-pink-50 py-12 mt-12 mb-16 px-4">
                <div class="max-w-4xl mx-auto text-center">
                    <h3 class="text-2xl md:text-3xl font-['Playfair_Display'] text-pink-600 mb-3">
                        The Essence of Elegance
                    </h3>
                    <p class="text-gray-600 mb-6">
                        Hand-picked materials, ethically sourced, and designed to last a lifetime. Quality is our promise.
                    </p>
                    <a href="#" class="text-gold border-b border-gold font-semibold hover:border-pink-600 transition duration-150" onclick="showMessage('This link is a placeholder.')">
                        Learn About Our Process &rarr;
                    </a>
                </div>
            </div>
        </section>

        <!-- ============================================== -->
        <!-- 2. CATEGORIES Section -->
        <!-- ============================================== -->
        <section id="section-categories" class="content-section hidden py-16 px-4 max-w-7xl mx-auto text-center">
            <!-- Content rendered by JS function renderCategories() -->
        </section>

        <!-- ============================================== -->
        <!-- 3. ACCESSORIES Section (Placeholder) -->
        <!-- ============================================== -->
        <section id="section-accessories" class="content-section hidden py-16 px-4 max-w-7xl mx-auto text-center">
            <div class="bg-soft-pink p-8 md:p-16 rounded-xl shadow-xl">
                <h3 class="text-4xl font-['Playfair_Display'] font-extrabold text-pink-700 mb-4">
                    The Accessories Collection
                </h3>
                <p class="text-lg text-gray-700 mb-8 max-w-2xl mx-auto">
                    A curated selection of jewelry, scarves, and handbags to complete your look. Each piece is chosen for its timeless allure and quality craftsmanship.
                </p>
                <img src="https://placehold.co/600x200/FFD700/8B4513?text=Luxury+Gold+Accents" alt="Luxury Accessories Placeholder" class="mx-auto rounded-lg shadow-md mb-8">
                <p class="text-gold text-xl font-bold mb-4">
                    Coming Soon: Exclusive Gold Plated Jewelry
                </p>
                <a href="#" class="btn-gold px-8 py-3 text-lg font-semibold rounded-full hover:shadow-lg inline-block" onclick="showSection('new-arrivals', this)">
                    Back to New Arrivals
                </a>
            </div>
        </section>

        <!-- ============================================== -->
        <!-- 4. BEAUTY Section (Placeholder) -->
        <!-- ============================================== -->
        <section id="section-beauty" class="content-section hidden py-16 px-4 max-w-7xl mx-auto text-center">
            <div class="bg-white p-8 md:p-16 rounded-xl shadow-xl border border-pink-100">
                <h3 class="text-4xl font-['Playfair_Display'] font-extrabold text-pink-700 mb-4">
                    Signature Beauty Line
                </h3>
                <p class="text-lg text-gray-700 mb-8 max-w-2xl mx-auto">
                    Experience the difference of clean, luxurious makeup and skincare that enhances your natural glow.
                </p>
                <img src="https://placehold.co/600x200/FCE4EC/DB2777?text=Pink+and+White+Skincare" alt="Beauty Placeholder" class="mx-auto rounded-lg shadow-md mb-8">
                 <p class="text-pink-600 text-xl font-bold mb-4">
                    Discover Our New Line of Rose-Infused Serums
                </p>
                <a href="#" class="btn-gold px-8 py-3 text-lg font-semibold rounded-full hover:shadow-lg inline-block" onclick="showSection('new-arrivals', this)">
                    Back to New Arrivals
                </a>
            </div>
        </section>
        
        <!-- ============================================== -->
        <!-- 5. ABOUT US Section -->
        <!-- ============================================== -->
        <section id="section-about-us" class="content-section hidden py-16 px-4 max-w-7xl mx-auto">
            <div class="bg-white p-8 md:p-16 rounded-xl shadow-2xl border border-pink-200">
                <h3 class="text-4xl font-['Playfair_Display'] font-extrabold text-pink-700 mb-6 text-center">
                    Our Story: Elegance Defined
                </h3>
                <div class="max-w-3xl mx-auto text-left space-y-6">
                    <p class="text-lg text-gray-700 border-l-4 border-gold pl-4 italic">
                        "Rejoice Allure was founded on the belief that true beauty is found in effortless grace and quality craftsmanship. We strive to bring a touch of luxury to the everyday lives of women across Ghana."
                    </p>
                    <p class="text-gray-600">
                        Established in **Accra**, Rejoice Allure quickly became known for its commitment to sourcing high-quality, ethically-produced accessories and beauty products. We blend timeless Western styles with vibrant Ghanaian flair, resulting in collections that are both sophisticated and deeply personal.
                    </p>
                    <p class="text-gray-600">
                        Our focus is on creating pieces that empower you. From our signature **Aurora Gold Necklace** to our **Blush Silk Scarf** collection, every item is designed to make you feel confident, radiant, and utterly alluring. Thank you for supporting our local vision of global elegance.
                    </p>
                    <div class="mt-8 text-center">
                        <button class="btn-gold px-8 py-3 text-lg font-semibold rounded-full hover:shadow-lg inline-block" onclick="showSection('new-arrivals', this)">
                            Explore Our Collections
                        </button>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- ============================================== -->
        <!-- 7. ACCOUNT / PROFILE Section (NEW PLACEHOLDER) -->
        <!-- ============================================== -->
        <section id="section-account" class="content-section hidden py-16 px-4 max-w-7xl mx-auto">
            <div class="bg-white p-8 md:p-16 rounded-xl shadow-2xl border border-pink-200 max-w-md mx-auto text-center">
                <h3 class="text-3xl font-['Playfair_Display'] font-bold text-pink-700 mb-8">
                    My Account Details
                </h3>
                <div class="space-y-4 text-left">
                    <p class="text-gray-600">This area holds your private information, secured by Firebase.</p>
                    <div class="bg-soft-pink p-4 rounded-lg">
                        <p class="font-bold text-gray-700">Auth Status:</p>
                        <p id="user-status" class="text-pink-600 text-sm italic">Initializing...</p>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <p class="font-bold text-gray-700">Your User ID:</p>
                        <p id="user-id-display" class="text-gray-800 break-words text-sm font-mono">Loading...</p>
                    </div>
                    <p class="text-sm text-gray-500 pt-4">Your current cart progress is being saved to this unique ID in Firestore.</p>
                </div>
            </div>
        </section>

        <!-- ============================================== -->
        <!-- 6. CONTACT Section -->
        <!-- ============================================== -->
        <section id="section-contact" class="content-section hidden py-16 px-4 max-w-7xl mx-auto">
            <div class="grid md:grid-cols-2 gap-12 p-8 md:p-16 rounded-xl shadow-2xl bg-white border border-pink-200">
                
                <!-- Contact Form -->
                <div>
                    <h3 class="text-3xl font-['Playfair_Display'] font-bold text-pink-700 mb-6">
                        Send Us A Message
                    </h3>
                    <form class="space-y-4">
                        <input type="text" id="contact-name" placeholder="Your Name" required class="w-full p-3 border border-pink-300 rounded-lg focus:ring-gold focus:border-gold">
                        <input type="email" id="contact-email" placeholder="Your Email Address" required class="w-full p-3 border border-pink-300 rounded-lg focus:ring-gold focus:border-gold">
                        <textarea id="contact-message" placeholder="Your Inquiry (e.g., product availability, order status)" rows="4" required class="w-full p-3 border border-pink-300 rounded-lg focus:ring-gold focus:border-gold"></textarea>
                        <button type="button" id="submit-contact-btn" class="btn-gold w-full py-3 rounded-lg text-lg font-semibold">
                            Submit Inquiry
                        </button>
                    </form>
                </div>

                <!-- Contact Info & Location (UPDATED) -->
                <div class="space-y-6">
                    <h3 class="text-3xl font-['Playfair_Display'] font-bold text-pink-700 mb-6">
                        Reach Out Directly
                    </h3>
                    
                    <div class="flex items-start space-x-3">
                        <svg class="w-6 h-6 text-gold flex-shrink-0 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.128a4.92 4.92 0 002.585 2.585l1.128-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path></svg>
                        <div>
                            <p class="font-bold text-gray-700">Phone & WhatsApp</p>
                            <a href="tel:+233242075619" class="text-pink-600 hover:underline">024 207 5619 / 026 081 8878</a>
                        </div>
                    </div>
                    
                    <div class="flex items-start space-x-3">
                        <svg class="w-6 h-6 text-gold flex-shrink-0 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8m-2 4v7a2 2 0 01-2 2H5a2 2 0 01-2-2v-7"></path></svg>
                        <div>
                            <p class="font-bold text-gray-700">Email Address</p>
                            <a href="mailto:support@rejoiceallure.com" class="text-pink-600 hover:underline">support@rejoiceallure.com</a>
                        </div>
                    </div>

                    <div class="flex items-start space-x-3">
                        <svg class="w-6 h-6 text-gold flex-shrink-0 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.828 0l-4.243-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                        <div>
                            <p class="font-bold text-gray-700">Studio Location</p>
                            <p class="text-gray-600">Osu High Street, Accra, Ghana (By Appointment Only)</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ============================================== -->
        <!-- 9. CART Section (UPDATED) -->
        <!-- ============================================== -->
        <section id="section-cart" class="content-section hidden py-16 px-4 max-w-7xl mx-auto">
            <div class="bg-white p-8 md:p-16 rounded-xl shadow-2xl border border-pink-200">
                <h3 class="text-4xl font-['Playfair_Display'] font-extrabold text-pink-700 mb-8 text-center">
                    Your Shopping Cart
                </h3>
                <div id="cart-content">
                    <!-- Cart items will be rendered here by JS -->
                </div>
            </div>
        </section>
        
        <!-- ============================================== -->
        <!-- 10. CHECKOUT / PAYMENT Section (UPDATED FOR PAYSTACK) -->
        <!-- ============================================== -->
        <section id="section-checkout" class="content-section hidden py-16 px-4 max-w-7xl mx-auto">
            <div class="bg-white p-8 md:p-16 rounded-xl shadow-2xl border border-pink-200">
                <h3 class="text-4xl font-['Playfair_Display'] font-extrabold text-pink-700 mb-8 text-center">
                    Secure Checkout
                </h3>
                
                <div class="max-w-xl mx-auto">
                    <!-- Order Summary Placeholder -->
                    <div id="checkout-summary" class="bg-soft-pink p-4 rounded-lg mb-8 text-center">
                        <p class="font-bold text-lg text-pink-700">Order Total: <span id="checkout-grand-total">â‚µ 0.00</span></p>
                        <p class="text-sm text-gray-600">Please select a payment method.</p>
                    </div>

                    <form id="payment-form" onsubmit="handlePayment(event)">
                        
                        <div class="space-y-6">
                            <h4 class="text-2xl font-['Playfair_Display'] font-bold text-gray-800 border-b pb-2 mb-4">Select Payment Method</h4>
                            
                            <!-- Paystack Branding -->
                            <p class="text-sm text-gray-500 mb-6 flex items-center justify-center space-x-2">
                                <span>Payments powered by</span>
                                <span class="font-extrabold text-lg text-green-700">Paystack</span>
                            </p>

                            <!-- Payment Options Grid -->
                            <div class="grid grid-cols-2 gap-4">
                                
                                <!-- CARD PAYMENT (Visa/MasterCard) -->
                                <label for="payment-card" class="payment-option border-2 border-pink-300 rounded-xl p-4 cursor-pointer hover:shadow-md transition duration-150 flex flex-col items-center text-center">
                                    <input type="radio" name="payment_method" id="payment-card" value="card" required class="hidden" onchange="togglePaymentFields('card')">
                                    <div class="flex space-x-2 mb-2">
                                        <!-- Visa SVG Icon -->
                                        <svg class="h-6 w-10" viewBox="0 0 47.96 32" xmlns="http://www.w3.org/2000/svg" fill="#1A1F71"><path d="M47.96 11.23c0-1.78-.45-3.35-1.35-4.71H42.7c.97 1.34 1.45 2.87 1.45 4.54 0 1.63-.48 3.1-1.42 4.41l3.52 5.51h4.63l-4.14-6.47c1.17-1.42 1.78-3.13 1.78-5.06z"/><path d="M12.44 2.14H6.38L.55 30.65H6.8l2.94-8.07c.07-.15.22-.44.42-.87l1.09-3.26h6.8c.45 1.5.83 2.92 1.14 4.26l2.16 6.94h6.05L26.33 2.14H20.1l-3.23 9.47-1.77 5.17-2.66-8.23c-.15-.47-.28-.73-.35-.87z"/></svg>
                                        <!-- MasterCard SVG Icon -->
                                        <svg class="h-6 w-10" viewBox="0 0 45.42 32" xmlns="http://www.w3.org/2000/svg" fill="#EB001B"><circle cx="14.38" cy="16" r="16"/><circle cx="31.04" cy="16" r="16" fill="#F79E1B" opacity=".8"/></svg>
                                    </div>
                                    <span class="font-semibold text-sm">Card Payment</span>
                                </label>
                                
                                <!-- MOBILE MONEY PAYMENT (MTN / Telecel) -->
                                <label for="payment-momo" class="payment-option border-2 border-pink-300 rounded-xl p-4 cursor-pointer hover:shadow-md transition duration-150 flex flex-col items-center text-center">
                                    <input type="radio" name="payment_method" id="payment-momo" value="momo" required class="hidden" onchange="togglePaymentFields('momo')">
                                    <div class="flex space-x-2 mb-2">
                                        <!-- MTN Mobile Money (Orange) -->
                                        <svg class="h-6 w-6" viewBox="0 0 24 24" fill="#FFCC00" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="12" r="10" stroke="#FFCC00" stroke-width="2"/><path d="M10 8l4 4-4 4" stroke="#000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                                        <!-- Generic Mobile Money Icon -->
                                        <svg class="h-6 w-6 text-pink-600" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 1H7a2 2 0 00-2 2v18a2 2 0 002 2h10a2 2 0 002-2V3a2 2 0 00-2-2zm-1 16H8a1 1 0 01-1-1v-4a1 1 0 011-1h8a1 1 0 011 1v4a1 1 0 01-1 1zm1-9H7V5h10v3zM12 21a1 1 0 110-2 1 1 0 010 2z"/></svg>
                                    </div>
                                    <span class="font-semibold text-sm">Mobile Money</span>
                                </label>
                            </div>
                            
                            <!-- Card Details Fields (Initially Hidden) -->
                            <div id="card-fields" class="space-y-4 pt-4 border-t border-pink-100 hidden">
                                <h5 class="font-bold text-gray-700">Enter Card Details (Via Paystack)</h5>
                                <input type="text" id="card-number" placeholder="Card Number" class="w-full p-3 border border-pink-300 rounded-lg focus:ring-gold focus:border-gold" maxlength="19" autocomplete="cc-number">
                                <div class="flex space-x-4">
                                    <input type="text" id="card-expiry" placeholder="MM/YY" class="w-1/2 p-3 border border-pink-300 rounded-lg focus:ring-gold focus:border-gold" maxlength="5" autocomplete="cc-exp">
                                    <input type="text" id="card-cvc" placeholder="CVC" class="w-1/2 p-3 border border-pink-300 rounded-lg focus:ring-gold focus:border-gold" maxlength="4" autocomplete="cc-csc">
                                </div>
                                <input type="text" id="card-name" placeholder="Name on Card" class="w-full p-3 border border-pink-300 rounded-lg focus:ring-gold focus:border-gold" autocomplete="cc-name">
                            </div>

                            <!-- Mobile Money Fields (Initially Hidden) -->
                            <div id="momo-fields" class="space-y-4 pt-4 border-t border-pink-100 hidden">
                                <h5 class="font-bold text-gray-700">Enter Mobile Money Details (Via Paystack)</h5>
                                <select id="momo-network" class="w-full p-3 border border-pink-300 rounded-lg focus:ring-gold focus:border-gold">
                                    <option value="">Select Network</option>
                                    <option value="MTN">MTN Mobile Money</option>
                                    <option value="Telecel">Telecel Cash</option>
                                    <option value="AirtelTigo">AirtelTigo Money</option>
                                </select>
                                <input type="tel" id="momo-number" placeholder="Mobile Money Number (e.g., 024xxxxxxx)" class="w-full p-3 border border-pink-300 rounded-lg focus:ring-gold focus:border-gold" maxlength="10">
                            </div>

                            <!-- Final Checkout Button -->
                            <button type="submit" class="btn-gold w-full py-3 rounded-lg text-lg font-semibold mt-6">
                                Confirm & Pay Now
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </section>
    </main>
    <!-- END MAIN CONTENT CONTAINER -->


    <!-- Footer (STATIC) -->
    <footer class="bg-gray-800 text-white py-10 px-4">
        <div class="max-w-7xl mx-auto grid grid-cols-2 md:grid-cols-4 gap-8">
            <div>
                <h4 class="text-lg font-bold text-pink-400 mb-4">Rejoice Allure</h4>
                <p class="text-sm text-gray-400">Where elegance meets everyday beauty. Follow us for exclusive updates.</p>
            </div>
            
            <div>
                <h4 class="text-lg font-bold text-gold mb-4">Support</h4>
                <ul class="space-y-2 text-sm">
                    <li><a href="#" class="text-gray-400 hover:text-pink-400 transition duration-150" onclick="showSection('contact', this)">Contact Us</a></li>
                    <li><a href="#" class="text-gray-400 hover:text-pink-400 transition duration-150" onclick="showMessage('This link is a placeholder.')">Shipping & Returns</a></li>
                    <li><a href="#" class="text-gray-400 hover:text-pink-400 transition duration-150" onclick="showMessage('This link is a placeholder.')">FAQs</a></li>
                </ul>
            </div>
            
            <div>
                <h4 class="text-lg font-bold text-gold mb-4">Quick Links</h4>
                <ul class="space-y-2 text-sm">
                    <li><a href="#" data-section="about-us" class="text-gray-400 hover:text-pink-400 transition duration-150" onclick="showSection('about-us', this)">About Us</a></li>
                    <li><a href="#" class="text-gray-400 hover:text-pink-400 transition duration-150" onclick="showMessage('This link is a placeholder.')">Privacy Policy</a></li>
                    <li><a href="#" class="text-gray-400 hover:text-pink-400 transition duration-150" onclick="showMessage('This link is a placeholder.')">Careers</a></li>
                </ul>
            </div>

            <div>
                <h4 class="text-lg font-bold text-gold mb-4">Newsletter</h4>
                <p class="text-sm text-gray-400 mb-4">Get 10% off your first order!</p>
                <form onsubmit="event.preventDefault(); showMessage('Thank you for subscribing!');">
                    <input type="email" placeholder="Your Email" class="w-full p-2 rounded-md bg-gray-700 border border-gray-600 focus:ring-pink-500 focus:border-pink-500 text-sm mb-3">
                    <button type="submit" class="btn-gold w-full py-2 rounded-md text-sm font-medium">Subscribe</button>
                </form>
            </div>
        </div>
        
        <div class="mt-10 pt-6 border-t border-gray-700 text-center text-sm text-gray-500">
            &copy; 2025 Rejoice Allure. All rights reserved. Prices in Ghana Cedis.
        </div>
    </footer>

    <!-- WhatsApp Floating Button -->
    <a href="https://wa.me/233242075619?text=Hello%2C%20I%20saw%20Rejoice%20Allure%27s%20website%20and%20I%20have%20a%20question%20about%20a%20product."
       target="_blank" 
       class="fixed bottom-6 right-6 z-50 p-3 bg-green-500 rounded-full shadow-xl hover:bg-green-600 transition duration-300 transform hover:scale-110"
       aria-label="Chat with Rejoice Allure on WhatsApp">
        <!-- WhatsApp Icon SVG -->
        <svg class="w-8 h-8 text-white" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
            <path d="M12.002 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm4.332 15.344c-.214 0-.428-.066-.622-.198l-2.072-1.15c-.178-.098-.376-.148-.574-.148-.198 0-.396.05-.574.148l-2.072 1.15c-.194.132-.408.198-.622.198-1.07 0-1.936-.866-1.936-1.936 0-1.07.866-1.936 1.936-1.936.214 0 .428.066.622.198l2.072 1.15c.178.098.376.148.574.148.198 0 .396-.05.574-.148l2.072-1.15c.194-.132.408-.198.622-.198 1.07 0 1.936.866 1.936 1.936 0 1.07-.866 1.936-1.936 1.936z"/>
        </svg>
    </a>
    
    <!-- FIREBASE SDK IMPORTS (Type="module" is necessary) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, updateDoc, onSnapshot, deleteField, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // --- GLOBAL FIREBASE VARIABLES ---
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        let app, db, auth, userId = null;
        let isAuthReady = false;
        const CART_DOC_ID = 'user_cart_data';

        // Set log level for debugging
        setLogLevel('Debug');

        // --- FIREBASE UTILITY FUNCTIONS ---
        
        const getCartDocRef = (uid) => {
            // Path: /artifacts/{appId}/users/{userId}/cart/user_cart_data
            return doc(db, 'artifacts', appId, 'users', uid, 'cart', CART_DOC_ID);
        };

        const updateFirestoreCart = async (newCartItems) => {
            if (!userId || !isAuthReady) {
                console.error("Firestore not ready or user ID missing for cart update.");
                return;
            }
            try {
                // Ensure the data structure is clean for Firestore (only quantity fields)
                await setDoc(getCartDocRef(userId), newCartItems);
                console.log("Cart updated in Firestore successfully.");
            } catch (error) {
                console.error("Error writing cart to Firestore: ", error);
                showMessage("Error saving cart progress. Check console for details.");
            }
        };
        
        const deleteItemFromFirestoreCart = async (productName) => {
            if (!userId || !isAuthReady) return;
            try {
                 await updateDoc(getCartDocRef(userId), {
                    [productName]: deleteField()
                 });
                 console.log(`${productName} deleted from Firestore cart.`);
            } catch (error) {
                // Ignore if document doesn't exist yet, but log if other error occurs
                 console.error("Error deleting item from Firestore: ", error);
            }
        };

        // --- CART LISTENER ---
        const startCartListener = (uid) => {
            if (!db) return;

            // Set up real-time listener on the user's cart document
            onSnapshot(getCartDocRef(uid), (docSnapshot) => {
                if (docSnapshot.exists()) {
                    // Update the global cartItems object with data from Firestore
                    cartItems = docSnapshot.data();
                    console.log("Cart data received from Firestore:", cartItems);
                } else {
                    cartItems = {}; // Cart document does not exist, so the cart is empty
                    console.log("Cart document does not exist, initializing empty cart.");
                }
                
                // Recalculate global cart count from the new cartItems state
                window.cartCount = Object.values(cartItems).reduce((sum, qty) => sum + qty, 0);
                
                // Update the UI (badge and currently visible cart/checkout page)
                if (window.cartCountElement) {
                    window.cartCountElement.textContent = window.cartCount;
                }
                
                // If the cart or checkout page is open, re-render it
                const currentSection = document.querySelector('.content-section:not(.hidden)');
                if (currentSection && currentSection.id === 'section-cart') {
                    window.renderCart();
                } else if (currentSection && currentSection.id === 'section-checkout') {
                    // Slight delay to ensure renderCart has time to finish
                    setTimeout(() => window.showSection('checkout', null), 50); 
                }

            }, (error) => {
                console.error("Error listening to Firestore cart: ", error);
                window.showMessage("Failed to load real-time cart data.");
            });
        };
        
        // --- AUTH & INITIALIZATION ---
        
        const initFirebase = async () => {
            if (Object.keys(firebaseConfig).length === 0) {
                 window.showMessage("Firebase config is missing. Cart persistence will be disabled.");
                 return;
            }
            
            window.showLoading(true, "Authenticating user...");
            
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);

            // Use onAuthStateChanged to manage user state reliably
            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    userId = user.uid;
                    isAuthReady = true;

                    // Update the Account page UI
                    document.getElementById('user-id-display').textContent = userId;
                    document.getElementById('user-status').textContent = 'Authenticated (UID retrieved)';

                    // Start listening to the user's cart
                    startCartListener(userId);
                    window.showLoading(false);
                    window.showMessage("Backend connected. Cart data is persistent!");
                } else {
                    // If no user is signed in, sign in using the custom token or anonymously
                    try {
                        if (initialAuthToken) {
                            await signInWithCustomToken(auth, initialAuthToken);
                        } else {
                            await signInAnonymously(auth);
                        }
                    } catch (error) {
                         console.error("Error during initial authentication:", error);
                         document.getElementById('user-status').textContent = 'Authentication Failed';
                         window.showMessage("Authentication failed. Cart will not be saved.");
                         window.showLoading(false);
                         isAuthReady = false;
                    }
                }
            });
        };
        
        // Expose Firebase functions to the global window object so they can be accessed by the main script block
        window.initFirebase = initFirebase;
        window.updateFirestoreCart = updateFirestoreCart;
        window.deleteItemFromFirestoreCart = deleteItemFromFirestoreCart;
        window.getUserId = () => userId;
        window.isAuthReady = () => isAuthReady;
        window.signOutFirebase = async () => {
            try {
                await signOut(auth);
                // After sign out, the onAuthStateChanged listener will handle the transition (e.g., to anonymous user)
                window.showMessage("Successfully signed out.");
            } catch (error) {
                window.showMessage("Error signing out.");
                console.error("Sign out error:", error);
            }
        };
    </script>
    
    <!-- JAVASCRIPT LOGIC (MUST be outside type="module" script) -->
    <script>
        // --- Product Data ---
        const allProducts = [
            { 
                name: "Aurora Gold Necklace", 
                category: "Accessories", 
                price: "1,290.00", 
                img: "https://placehold.co/400x400/FFD700/8B4513?text=Gold+Necklace",
                imgAlt: "Gold Charm Necklace"
            },
            { 
                name: "Blush Silk Scarf", 
                category: "Luxury Wear", 
                price: "450.00", 
                img: "https://placehold.co/400x400/F472B6/ffffff?text=Silk+Scarf",
                imgAlt: "Pink Silk Scarf"
            },
            { 
                name: "Luminance Pearl Drops", 
                category: "Jewelry", 
                price: "750.00", 
                img: "https://placehold.co/400x400/FFFFFF/DB2777?text=Pearl+Earrings",
                imgAlt: "White Pearl Earrings"
            },
            { 
                name: "Gilded Glamour Palette", 
                category: "Beauty", 
                price: "390.00", 
                img: "https://placehold.co/400x400/FCE7F6/B8860B?text=Eyeshadow+Palette",
                imgAlt: "Gold & Pink Eyeshadow"
            },
            { 
                name: "Rose Gold Bangle", 
                category: "Accessories", 
                price: "920.00", 
                img: "https://placehold.co/400x400/FECACA/A855F7?text=Rose+Bangle",
                imgAlt: "Rose Gold Bangle"
            },
            { 
                name: "Velvet Matte Lipstick", 
                category: "Beauty", 
                price: "150.00", 
                img: "https://placehold.co/400x400/9D174D/FCE7F6?text=Lipstick",
                imgAlt: "Velvet Matte Lipstick"
            },
            { 
                name: "Luxury Argan Hair Oil", 
                category: "Beauty", 
                price: "480.00", 
                img: "https://placehold.co/400x400/FFC72C/4C051E?text=Hair+Oil+Argan",
                imgAlt: "Luxury Argan Hair Oil"
            },
            { 
                name: "Rosemary Growth Shampoo", 
                category: "Beauty", 
                price: "220.00", 
                img: "https://placehold.co/400x400/A7F3D0/10B981?text=Shampoo+Rosemary",
                imgAlt: "Rosemary Growth Shampoo"
            },
            { 
                name: "Silk Bonnet Hair Wrap", 
                category: "Luxury Wear", 
                price: "180.00", 
                img: "https://placehold.co/400x400/DB2777/FFFFFF?text=Silk+Bonnet",
                imgAlt: "Silk Bonnet Hair Wrap"
            },
            // --- HAIR EXTENSIONS PRODUCTS ---
            { 
                name: "Brazilian Deep Wave Hair", 
                category: "Hair Extensions", 
                price: "3,500.00", 
                img: "https://placehold.co/400x400/9D174D/FFD700?text=Deep+Wave", 
                imgAlt: "Brazilian Deep Wave Hair"
            },
            { 
                name: "Peruvian Straight Lace Wig", 
                category: "Hair Extensions", 
                price: "6,800.00", 
                img: "https://placehold.co/400x400/8B4513/FFFFFF?text=Lace+Wig", 
                imgAlt: "Peruvian Straight Lace Wig"
            },
            { 
                name: "Kinky Curly Closure", 
                category: "Hair Extensions", 
                price: "950.00", 
                img: "https://placehold.co/400x400/27272A/FFD700?text=Kinky+Closure", 
                imgAlt: "Kinky Curly Closure"
            }
        ];

        // Global variables for state and elements (shared with module script)
        window.cartCount = 0;
        window.cartItems = {}; // Cart items are synced by Firestore listener in module script
        window.checkoutTotal = 0; 
        
        // DOM element variables assigned in DOMContentLoaded
        let cartCountElement, menuButton, mobileMenu, messageBox, loadingOverlay; 
        let productListContainer, searchFeedback, searchInputDesktop, searchInputMobile;
        
        window.showMessage = function(text) {
            if (!messageBox) return;
            messageBox.textContent = text;
            messageBox.classList.remove('translate-x-full', 'opacity-0');
            messageBox.classList.add('translate-x-0', 'opacity-100');

            setTimeout(() => {
                messageBox.classList.remove('translate-x-0', 'opacity-100');
                messageBox.classList.add('translate-x-full', 'opacity-0');
            }, 4000);
        };
        
        window.showLoading = function(show, message = "Processing...") {
            if (!loadingOverlay) return;
            loadingOverlay.classList.toggle('hidden', !show);
            const loadingText = loadingOverlay.querySelector('p');
            if (loadingText) loadingText.textContent = message;
        };


        // --- PRODUCT RENDERING & SEARCH ---
        
        function renderProducts(products) {
            if (!productListContainer || !searchFeedback) return;
            
            productListContainer.innerHTML = '';
            
            if (products.length === 0) {
                searchFeedback.classList.remove('hidden');
                return;
            }
            searchFeedback.classList.add('hidden');

            products.forEach(product => {
                const card = document.createElement('div');
                card.className = 'bg-white rounded-xl shadow-lg hover:shadow-2xl transition duration-300 overflow-hidden border border-pink-100';
                
                card.innerHTML = `
                    <img src="${product.img}" alt="${product.imgAlt}" onerror="this.src='https://placehold.co/400x400/FFC0CB/555555?text=Image+Error'" class="w-full h-48 object-cover object-center">
                    <div class="p-4 md:p-6 text-center">
                        <p class="text-sm text-gold font-semibold mb-1">${product.category}</p>
                        <h4 class="text-lg font-['Playfair_Display'] text-gray-800 font-bold mb-2">${product.name}</h4>
                        <p class="text-xl text-pink-600 font-extrabold mb-4">â‚µ ${product.price}</p>
                        <button class="add-to-cart-btn btn-gold w-full py-2 rounded-lg text-sm font-medium" data-name="${product.name}">Add to Cart</button>
                    </div>
                `;
                productListContainer.appendChild(card);
            });
            
            attachAddToCartListeners();
        }
        
        function handleSearch(query) {
            if (!searchInputDesktop || !searchInputMobile) return;
            
            const newArrivalsSection = document.getElementById('section-new-arrivals');
            if (newArrivalsSection && newArrivalsSection.classList.contains('hidden')) {
                showSection('new-arrivals', null); 
                if(mobileMenu) mobileMenu.classList.add('hidden');
            }
            
            searchInputDesktop.value = query;
            searchInputMobile.value = query;

            const lowerQuery = query.toLowerCase().trim();
            let filteredProducts;

            if (lowerQuery === "") {
                filteredProducts = allProducts;
            } else {
                filteredProducts = allProducts.filter(product => 
                    product.name.toLowerCase().includes(lowerQuery)
                );
            }

            renderProducts(filteredProducts);
        }
        
        // --- CATEGORIES LOGIC ---
        function renderCategories() {
            const categoriesSection = document.getElementById('section-categories');
            if (!categoriesSection) return;

            const uniqueCategories = [...new Set(allProducts.map(p => p.category))];

            let contentHTML = `
                <div class="py-16 px-4 max-w-7xl mx-auto text-center">
                    <h3 class="text-4xl font-['Playfair_Display'] font-extrabold text-pink-700 mb-12">
                        Shop By Category
                    </h3>
                    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-8">
            `;
            
            uniqueCategories.forEach(category => {
                const placeholderColors = {
                    "Accessories": "FFD700/8B4513",
                    "Luxury Wear": "F472B6/ffffff",
                    "Jewelry": "FFFFFF/DB2777",
                    "Beauty": "FCE7F6/B8860B",
                    "Hair Extensions": "DB2777/FFD700" 
                };
                const colors = placeholderColors[category] || "fce4ec/DB2777";
                let imgUrl = `https://placehold.co/400x250/${colors}?text=${category.replace(/\s/g, '+')}`;

                contentHTML += `
                    <div class="bg-white rounded-xl shadow-lg hover:shadow-2xl transition duration-300 overflow-hidden cursor-pointer border border-pink-100" onclick="filterByCategory('${category}')">
                        <img src="${imgUrl}" alt="${category} products" class="w-full h-48 object-cover object-center">
                        <div class="p-6">
                            <h4 class="text-2xl font-['Playfair_Display'] text-gray-800 font-bold mb-1">${category}</h4>
                            <p class="text-sm text-gold font-semibold">View All Items &rarr;</p>
                        </div>
                    </div>
                `;
            });

            contentHTML += `
                    </div>
                </div>
            `;
            categoriesSection.innerHTML = contentHTML;
        }

        function filterByCategory(categoryName) {
            showSection('new-arrivals', null, false);
            
            if(searchInputDesktop) searchInputDesktop.value = categoryName;
            if(searchInputMobile) searchInputMobile.value = categoryName;

            handleSearch(categoryName);
            showMessage(`Displaying results for category: ${categoryName}`);
        }
        
        // --- NAVIGATION LOGIC ---
        window.showSection = function(sectionId, element, clearSearch = false) {
            if (event) event.preventDefault(); 

            if (clearSearch || sectionId !== 'new-arrivals') {
                handleSearch('');
            }

            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.add('hidden');
            });

            const targetSection = document.getElementById(`section-${sectionId}`);
            if (targetSection) {
                targetSection.classList.remove('hidden');
                window.scrollTo(0, 0); 
            }
            
            if (sectionId === 'cart') {
                renderCart();
            } else if (sectionId === 'checkout') {
                const totalElement = document.getElementById('checkout-grand-total');
                if (totalElement) {
                    totalElement.textContent = `â‚µ ${checkoutTotal.toLocaleString('en-GH', { minimumFractionDigits: 2 })}`;
                }
                togglePaymentFields(null);
            }

            document.querySelectorAll('.nav-link, .nav-link-mobile').forEach(link => {
                link.classList.remove('nav-active');
            });

            if (element && (element.classList.contains('nav-link') || element.classList.contains('nav-link-mobile'))) {
                element.classList.add('nav-active');
            }
            
            const activeLink = document.querySelector(`.nav-link[data-section="${sectionId}"]`);
            if (activeLink) {
                 activeLink.classList.add('nav-active');
            }
            
            if (mobileMenu) mobileMenu.classList.add('hidden');
        }
        
        // --- CART LOGIC ---
        
        window.updateCartQuantity = function(input) {
            if (!window.isAuthReady()) {
                showMessage("Authentication not ready. Cannot update cart.");
                return;
            }
            
            const productName = input.getAttribute('data-product');
            const newQuantity = parseInt(input.value);

            if (isNaN(newQuantity) || newQuantity < 0) {
                 input.value = window.cartItems[productName] || 0;
                 showMessage("Quantity must be a positive number.");
                 return;
            }

            window.showLoading(true, "Updating cart...");
            
            // 1. Prepare update object for Firestore
            let updateData = {};
            if (newQuantity === 0) {
                // Use deleteField from the module script (if it exists)
                if (window.deleteItemFromFirestoreCart) {
                    window.deleteItemFromFirestoreCart(productName)
                        .then(() => window.showLoading(false))
                        .catch(() => window.showLoading(false));
                } else {
                    showMessage("Error: Delete function not available.");
                    window.showLoading(false);
                }
                
            } else {
                updateData[productName] = newQuantity;
                
                // 2. Update Firestore with new quantity (merging)
                window.updateFirestoreCart({...window.cartItems, ...updateData})
                    .then(() => window.showLoading(false))
                    .catch(() => window.showLoading(false));
            }
            
            // Note: The UI update (renderCart) is handled by the onSnapshot listener after Firestore confirms the change.
        }

        window.renderCart = function() {
            const cartContent = document.getElementById('cart-content');
            if (!cartContent) return;
            
            const itemKeys = Object.keys(window.cartItems).filter(key => window.cartItems[key] > 0);
            
            if (itemKeys.length === 0) {
                cartContent.innerHTML = `
                    <div class="text-center py-10">
                        <p class="text-2xl text-gray-500 font-medium mb-4">Your cart is currently empty.</p>
                        <p class="text-gray-600">Browse our featured products to add some allure!</p>
                        <button class="btn-gold px-6 py-2 mt-6 rounded-full" onclick="showSection('new-arrivals', this)">
                            Continue Shopping
                        </button>
                    </div>
                `;
                window.checkoutTotal = 0;
                return;
            }

            let cartHTML = `
                <div class="hidden sm:grid grid-cols-5 text-sm font-semibold text-gray-500 border-b pb-2 mb-4">
                    <span class="col-span-2">Product</span>
                    <span class="text-center">Price</span>
                    <span class="text-center">Quantity</span>
                    <span class="text-right">Total</span>
                </div>
                <ul class="divide-y divide-pink-100 mb-8">
            `;
            let subtotal = 0;

            itemKeys.forEach(productName => {
                const quantity = window.cartItems[productName];
                const productDetail = allProducts.find(p => p.name === productName);
                
                if (productDetail) {
                    const pricePerItem = parseFloat(productDetail.price.replace(/,/g, ''));
                    const itemTotal = pricePerItem * quantity;
                    subtotal += itemTotal;
                    
                    cartHTML += `
                        <li class="flex flex-col sm:grid sm:grid-cols-5 items-center py-4 gap-2">
                            
                            <div class="flex items-center space-x-4 col-span-2 w-full sm:w-auto">
                                <img src="${productDetail.img}" alt="${productDetail.imgAlt}" class="w-16 h-16 object-cover rounded-lg border border-pink-100 flex-shrink-0">
                                <div class="text-left flex-grow">
                                    <p class="font-bold text-gray-800">${productName}</p>
                                    <p class="text-sm text-gray-500 sm:hidden">Price: â‚µ ${pricePerItem.toLocaleString('en-GH', { minimumFractionDigits: 2 })}</p>
                                </div>
                            </div>
                            
                            <p class="hidden sm:block text-center text-gray-700">â‚µ ${pricePerItem.toLocaleString('en-GH', { minimumFractionDigits: 2 })}</p>

                            <div class="w-full sm:w-auto text-center flex items-center justify-center space-x-2">
                                <span class="sm:hidden text-gray-600">Qty:</span>
                                <input type="number" 
                                    class="w-20 p-1 text-center border border-pink-300 rounded-lg text-gray-800 focus:border-pink-500 focus:ring-pink-500"
                                    min="0" 
                                    value="${quantity}" 
                                    data-product="${productName}"
                                    onchange="updateCartQuantity(this)">
                            </div>
                            
                            <p class="font-bold text-gold text-lg w-full sm:w-auto text-right mt-2 sm:mt-0">
                                â‚µ ${itemTotal.toLocaleString('en-GH', { minimumFractionDigits: 2 })}
                            </p>
                        </li>
                    `;
                }
            });

            const shippingFee = 50.00;
            const grandTotal = subtotal + shippingFee;
            window.checkoutTotal = grandTotal;

            cartHTML += `</ul>`;
            
            cartHTML += `
                <div class="max-w-md ml-auto space-y-3 pt-6 border-t-2 border-pink-200">
                    <div class="flex justify-between font-medium">
                        <span class="text-gray-600">Subtotal:</span>
                        <span class="text-gray-800">â‚µ ${subtotal.toLocaleString('en-GH', { minimumFractionDigits: 2 })}</span>
                    </div>
                    <div class="flex justify-between font-medium">
                        <span class="text-gray-600">Shipping (Flat Rate):</span>
                        <span class="text-gray-800">â‚µ ${shippingFee.toFixed(2)}</span>
                    </div>
                    <div class="flex justify-between text-xl font-extrabold text-pink-700 pt-2 border-t border-pink-300">
                        <span>Grand Total:</span>
                        <span>â‚µ ${grandTotal.toLocaleString('en-GH', { minimumFractionDigits: 2 })}</span>
                    </div>
                </div>
                
                <div class="mt-8 text-center">
                    <button class="btn-gold px-8 py-3 text-lg font-semibold rounded-full hover:shadow-lg" onclick="showSection('checkout', this)">
                        Proceed to Checkout
                    </button>
                </div>
            `;

            cartContent.innerHTML = cartHTML;
        }

        function attachAddToCartListeners() {
            document.querySelectorAll('.add-to-cart-btn').forEach(button => {
                if (button.hasAttribute('data-listener-added')) return;
                button.setAttribute('data-listener-added', 'true');

                button.addEventListener('click', (event) => {
                    if (!window.isAuthReady()) {
                        showMessage("Connecting to backend. Please wait a moment.");
                        return;
                    }

                    const productName = event.target.getAttribute('data-name');
                    const currentQty = (window.cartItems[productName] || 0) + 1;
                    
                    window.showLoading(true, "Adding to cart...");
                    
                    // Create an object containing the full intended cart state
                    const newCartState = {...window.cartItems, [productName]: currentQty};

                    // Send the full new state to Firestore
                    window.updateFirestoreCart(newCartState)
                        .then(() => {
                            // Firestore listener handles showMessage and showLoading(false)
                            console.log("Add to cart action dispatched.");
                        })
                        .catch(() => window.showLoading(false));
                });
            });
        }
        
        // --- CONTACT FORM LOGIC ---
        function openEmailClient() {
            // ... (Contact form logic remains the same)
            const name = document.getElementById('contact-name').value;
            const email = document.getElementById('contact-email').value;
            const message = document.getElementById('contact-message').value;

            if (!name || !email || !message) {
                showMessage("Please fill in all fields (Name, Email, and Inquiry) before sending.");
                return;
            }

            const subject = encodeURIComponent(`Inquiry from ${name} (Rejoice Allure Website)`);
            const body = encodeURIComponent(
                `Sender Name: ${name}\n` +
                `Sender Email: ${email}\n\n` +
                `--- Message ---\n` +
                `${message}`
            );

            const mailtoLink = `mailto:support@rejoiceallure.com?subject=${subject}&body=${body}`;
            window.location.href = mailtoLink;
        }
        
        // --- PAYMENT LOGIC (UPDATED TO CLEAR CART IN FIREBASE) ---

        function togglePaymentFields(method) {
            // ... (Payment field toggle remains the same)
            const cardFields = document.getElementById('card-fields');
            const momoFields = document.getElementById('momo-fields');
            
            if (!cardFields || !momoFields) return;

            cardFields.classList.add('hidden');
            momoFields.classList.add('hidden');
            
            document.querySelectorAll('#card-fields input').forEach(input => input.removeAttribute('required'));
            document.querySelectorAll('#momo-fields input, #momo-fields select').forEach(input => input.removeAttribute('required'));

            if (method === 'card') {
                cardFields.classList.remove('hidden');
                document.querySelectorAll('#card-fields input').forEach(input => input.setAttribute('required', 'required'));
            } else if (method === 'momo') {
                momoFields.classList.remove('hidden');
                document.querySelectorAll('#momo-fields input, #momo-fields select').forEach(input => input.setAttribute('required', 'required'));
            }
        }

        async function handlePayment(event) {
            event.preventDefault();
            if (!window.isAuthReady()) {
                showMessage("Backend not ready. Please try again in a moment.");
                return;
            }

            const selectedMethod = document.querySelector('input[name="payment_method"]:checked')?.value;
            const totalDisplay = document.getElementById('checkout-grand-total')?.textContent || 'â‚µ 0.00';

            if (!selectedMethod) {
                showMessage("Please select a payment method.");
                return;
            }
            
            window.showLoading(true, "Processing payment via Paystack...");
            
            let successMessage = `PAYSTACK SUCCESS: Transaction for ${totalDisplay} completed. Your order is confirmed.`;
            let success = true;

            // --- PAYSTACK SIMULATION & VALIDATION ---
            if (selectedMethod === 'card') {
                const cardNumber = document.getElementById('card-number').value;
                if (cardNumber.length < 16) {
                     showMessage(`PAYSTACK CARD ERROR: Invalid card number provided. Simulation failed.`);
                     success = false;
                }
            } else if (selectedMethod === 'momo') {
                const momoNumber = document.getElementById('momo-number').value;
                const momoNetwork = document.getElementById('momo-network').value;
                
                if (momoNetwork === "") {
                    showMessage(`PAYSTACK MOMO ERROR: Please select your network. Simulation failed.`);
                    success = false;
                } else if (momoNumber.length < 10) {
                    showMessage(`PAYSTACK MOMO ERROR: Invalid mobile number. Simulation failed.`);
                    success = false;
                } else {
                    successMessage = `PAYSTACK INITIATED: Payment of ${totalDisplay} initiated via ${momoNetwork}. Please check your phone for the confirmation prompt.`;
                }
            }
            
            if (success) {
                // CLEAR CART IN FIREBASE
                try {
                    await window.updateFirestoreCart({}); // Set cart document to empty object
                    
                    // The onSnapshot listener will handle the UI update (cartCount=0 and renderCart)
                    
                    showMessage(successMessage);
                    
                    // Clear form fields and redirect
                    document.getElementById('payment-form').reset();
                    togglePaymentFields(null);
                    setTimeout(() => window.showSection('new-arrivals'), 3000);

                } catch (error) {
                    console.error("Failed to clear cart after payment: ", error);
                    showMessage("Payment confirmed, but failed to update cart state on server.");
                }
                
            } else {
                 // Failure message already set in validation block
            }
            window.showLoading(false);
        }

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            // 0. ASSIGN DOM ELEMENTS
            window.cartCountElement = document.getElementById('cart-count');
            menuButton = document.getElementById('menu-button');
            mobileMenu = document.getElementById('mobile-menu');
            messageBox = document.getElementById('message-box');
            loadingOverlay = document.getElementById('loading-overlay'); // Get loader
            productListContainer = document.getElementById('product-list');
            searchFeedback = document.getElementById('search-feedback');
            searchInputDesktop = document.getElementById('product-search-desktop');
            searchInputMobile = document.getElementById('product-search-mobile');
            
            // 1. START FIREBASE
            if (window.initFirebase) {
                window.initFirebase();
            } else {
                window.showMessage("Firebase module failed to load. Running in simulation mode.");
            }

            // 2. Initial render (will be overwritten by Firestore onSnapshot soon after)
            renderProducts(allProducts);

            // 3. Render categories list
            renderCategories();
            
            // 4. Mobile Menu Toggle
            if (menuButton) {
                menuButton.addEventListener('click', () => {
                    if (mobileMenu) mobileMenu.classList.toggle('hidden');
                });
            }
            
            // 5. Contact Form Button Listener
            const submitContactBtn = document.getElementById('submit-contact-btn');
            if (submitContactBtn) {
                submitContactBtn.addEventListener('click', openEmailClient);
            }
            
            // 6. Payment Form Listener
            const paymentForm = document.getElementById('payment-form');
            if (paymentForm) {
                paymentForm.addEventListener('submit', handlePayment);
            }

            // 7. Initial Nav state (show 'New Arrivals' by default)
             window.showSection('new-arrivals', document.querySelector('.nav-link[data-section="new-arrivals"]'));
        });

        // Function for the 'Shop The New Collection' button on the hero
        function scrollToProducts() {
            const productListStart = document.getElementById('product-list-start');
            if (productListStart) {
                 productListStart.scrollIntoView({ behavior: 'smooth' });
            }
        }
    </script>
</body>
</html>
